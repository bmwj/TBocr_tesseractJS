<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒæ™ºèƒ½æ–‡å­—è¯†åˆ« - Tesseract.js å¤šè¯­è¨€ OCR</title>
    <!-- é¢„åŠ è½½è—æ–‡å­—ä½“ -->
    <link rel="preload" href="/fontfile/æ–¹æ­£è—æ„æ±‰ä½“ç®€ä½“.TTF" as="font" type="font/ttf" crossorigin>
    <!-- PDF.js åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="/dist/tesseract.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        /* è‡ªå®šä¹‰è—æ–‡å­—ä½“ */
        @font-face {
            font-family: 'FangZheng-Zangyi';
            src: url('/fontfile/æ–¹æ­£è—æ„æ±‰ä½“ç®€ä½“.TTF') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        
        /* ä¼ ç»Ÿè—å¼é£æ ¼é…è‰² */
        :root {
            --tibetan-red: #990000;      /* è—çº¢ï¼Œå¯¹åº”ä¼ ç»Ÿå¯ºåº™æ¯çº¢è‰² */
            --tibetan-gold: #bf9b30;     /* è—é‡‘ï¼Œå¯¹åº”ä¼ ç»Ÿé‡‘é»„è‰² */
            --tibetan-blue: #3a75c4;     /* æ·±æ¨¡è“ï¼Œå¯¹åº”å¤©ç©ºè“ */
            --tibetan-orange: #c1651a;   /* èµ¤åœŸè‰²ï¼Œå¯¹åº”è—æ—åœ°åŒºçš„åœŸå£è‰² */
            --tibetan-purple: #5d478b;   /* ç²—èŠ±ç´«ï¼Œå¯¹åº”è—åŒ»å¸¸ç”¨çš„äº”å½©ç»´ä»–å…°è‰² */
            --tibetan-cream: #f2e9d9;    /* ç„–ç‰›ä¹³è‰²ï¼Œå¯¹åº”é…’é…ªé¢œè‰² */
            --tibetan-brown: #663300;    /* å¤§å‹æ£•ï¼Œå¯¹åº”è—æ—æœé¥°ä¸­å¸¸è§çš„æ·±æ£•è‰² */
            --tibetan-maroon: #800000;   /* é’ç¨€è‰²ï¼Œå¯¹åº”å¯ºåº™æŸŸç‚‰å’Œåƒ§è¡£è‰² */
            --tibetan-turquoise: #40e0d0; /* ç»µç²’ç»¿æ¾çŸ³è‰²ï¼Œè—æ—çè§å®çŸ³ */
            --tibetan-coral: #ff7f50;    /* çŠç‘šçº¢ï¼Œè—æ—çè§è£…é¥°ç å® */
        }
        
        /* å…¨å±€å­—ä½“è®¾ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'FangZheng-Zangyi', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }
        
        /* ç‰¹åˆ«æŒ‡å®šæ‰€æœ‰æ–‡æœ¬å…ƒç´ ä½¿ç”¨è—æ–‡å­—ä½“ */
        h1, h2, h3, h4, h5, h6, p, span, div, button, input, select, textarea, label {
            font-family: 'FangZheng-Zangyi', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        body {
            font-family: 'FangZheng-Zangyi', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            /* çº¯ç™½è‰²èƒŒæ™¯ */
            background: #ffffff;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            transition: background 0.8s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.1),
                0 1px 0px rgba(255, 255, 255, 0.8) inset,
                0 -1px 0px rgba(0, 0, 0, 0.05) inset;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--tibetan-red) 0%, var(--tibetan-maroon) 100%);
            color: white;
            padding: 24px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid var(--tibetan-gold);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            font-weight: 700;
            background: linear-gradient(45deg, #ffffff, #f0f8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.95;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 32px 40px;
            background: rgba(255, 255, 255, 0.7);
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
            min-height: calc(100vh - 120px);
        }
        
        .welcome-message {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border-radius: 24px;
            margin-bottom: 32px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
        }
        
        .welcome-content {
            text-align: center;
            max-width: 500px;
            padding: 40px 20px;
        }
        
        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 24px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        .welcome-content h2 {
            font-size: 2rem;
            color: #1e293b;
            margin-bottom: 16px;
            font-weight: 700;
        }
        
        .welcome-content p {
            font-size: 1.1rem;
            color: #64748b;
            margin-bottom: 32px;
            line-height: 1.6;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .feature-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }
        
        .feature-icon {
            font-size: 1.5rem;
        }
        
        .feature-item span:last-child {
            font-size: 0.9rem;
            color: #475569;
            font-weight: 500;
        }
        
        .arrow-hint {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: #667eea;
            font-weight: 500;
        }
        
        .arrow {
            font-size: 1.2rem;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        .controls-panel {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(0, 0, 0, 0.05);
            height: fit-content;
            position: sticky;
            top: 32px;
        }
        
        .controls-panel h2 {
            font-size: 1.3rem;
            margin-bottom: 24px;
            color: #1e293b;
            font-weight: 600;
            text-align: center;
            padding-bottom: 16px;
            border-bottom: 2px solid #e2e8f0;
        }

        .controls-panel .upload-section {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border: 2px dashed #cbd5e1;
            border-radius: 16px;
            padding: 24px 16px;
            text-align: center;
            margin-bottom: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .controls-panel .upload-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
            transform: scale(0);
            transition: transform 0.4s ease;
        }

        .controls-panel .upload-section:hover {
            border-color: #667eea;
            background: linear-gradient(145deg, #f0f4ff, #f8fafc);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.1);
        }

        .controls-panel .upload-section:hover::before {
            transform: scale(1);
        }

        .controls-panel .upload-section.dragover {
            border-color: #667eea;
            background: linear-gradient(145deg, #eef2ff, #f0f4ff);
            box-shadow: 0 12px 25px rgba(102, 126, 234, 0.15);
        }
        
        .controls-panel .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 12px;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            width: 100%;
        }

        .controls-panel .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #7c8fe8 0%, #8a5aa8 100%);
        }
        
        .controls-panel .upload-section p {
            font-size: 0.9rem;
            margin: 8px 0 4px 0;
            color: #64748b;
        }
        
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
            margin: 20px 0;
        }
        
        .diagnostic-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }
        
        .diagnostic-section h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: #475569;
            font-weight: 600;
        }
        
        .diagnostic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .diagnostic-label {
            color: #64748b;
        }
        
        .diagnostic-value {
            color: #1e293b;
            font-weight: 500;
        }
        
        .diagnostic-tip {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-size: 0.85rem;
            color: #9a3412;
            line-height: 1.4;
        }

        .upload-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
            transform: scale(0);
            transition: transform 0.4s ease;
        }

        .upload-section:hover {
            border-color: #667eea;
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .upload-section:hover::before {
            transform: scale(1);
        }

        .upload-section.dragover {
            border-color: #667eea;
            background: linear-gradient(145deg, #eef2ff, #f0f4ff);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.2);
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, var(--tibetan-gold) 0%, var(--tibetan-orange) 100%);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
            box-shadow: 0 8px 25px rgba(218, 165, 32, 0.4);
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(139, 0, 0, 0.5);
            background: linear-gradient(135deg, var(--tibetan-red) 0%, var(--tibetan-maroon) 100%);
        }

        .upload-btn:active {
            transform: translateY(-1px);
        }

        .language-section {
            margin-bottom: 24px;
        }

        .language-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1e293b;
            font-size: 1rem;
        }

        .language-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.9rem;
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            appearance: none;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%236b7280" d="M6 8L0 0h12L6 8z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            cursor: pointer;
        }

        .language-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .language-select:hover {
            border-color: #cbd5e1;
        }

        .quick-mode {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);
            position: relative;
            overflow: hidden;
        }

        .quick-mode::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #f59e0b, #fbbf24, #f59e0b);
        }
        
        .toggle-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            text-align: left;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .toggle-btn:hover {
            background: #e9ecef;
        }

        .options-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 16px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .option-group {
            background: white;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
        }

        .option-group h3 {
            margin-bottom: 12px;
            color: #1e293b;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover {
            background: #f8fafc;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            accent-color: #667eea;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            user-select: none;
            font-weight: 400;
            font-size: 0.9rem;
        }

        .results-section {
            display: none;
            flex-direction: column;
            gap: 24px;
            margin-top: 32px;
            background: white;
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .result-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        
        .image-preview {
            text-align: center;
        }
        
        .text-output {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
        }

        .image-preview {
            text-align: center;
        }

        .image-preview h3 {
            margin-bottom: 24px;
            color: #1e293b;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 450px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .image-preview img:hover {
            transform: scale(1.02);
        }

        .text-output {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
        }

        .text-output h3 {
            margin-bottom: 24px;
            color: #1e293b;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .text-content {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            min-height: 250px;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.95rem;
            color: #374151;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            /* æ·»åŠ æ»šåŠ¨æ¡æ”¯æŒ */
            max-height: 500px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .text-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .text-content::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
            margin: 4px;
        }
        
        .text-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        
        .text-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6b46c1);
        }
        
        /* Firefox æ»šåŠ¨æ¡æ ·å¼ */
        .text-content {
            scrollbar-width: thin;
            scrollbar-color: #667eea #f1f5f9;
        }
        
        /* é€šç”¨æ»šåŠ¨æ¡æ ·å¼ç±» */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: var(--tibetan-gold) var(--tibetan-cream);
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--tibetan-cream);
            border-radius: 4px;
            margin: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--tibetan-gold), var(--tibetan-orange));
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        
        /* ç»“æœæ“ä½œæŒ‰é’®æ ·å¼ */
        .result-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            background: linear-gradient(135deg, var(--tibetan-gold), var(--tibetan-orange));
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, var(--tibetan-red), var(--tibetan-maroon));
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .copy-btn:hover {
            background: linear-gradient(135deg, var(--tibetan-blue), var(--tibetan-purple));
        }
        
        .save-btn:hover {
            background: linear-gradient(135deg, var(--tibetan-mint), var(--tibetan-blue));
        }
        
        /* ä¸ºé•¿æ–‡æœ¬å†…å®¹æ·»åŠ æ»šåŠ¨æç¤º */
        .text-content::after {
            content: '';
            display: block;
            height: 0;
            clear: both;
        }
        
        .text-content:hover::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #5a6fd8, #6b46c1);
        }
        
        /* æ‰¹é‡å¤„ç†ç›¸å…³æ ·å¼ */
        .batch-info {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 1px solid #93c5fd;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }
        
        .batch-info.show {
            display: block;
            animation: fadeInUp 0.4s ease;
        }
        
        .batch-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .batch-title {
            font-weight: 600;
            color: #1e40af;
            font-size: 1rem;
        }
        
        .batch-progress {
            font-size: 0.9rem;
            color: #1d4ed8;
        }
        
        .batch-actions {
            display: flex;
            gap: 8px;
        }
        
        .batch-btn {
            padding: 6px 12px;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            background: white;
            color: #3b82f6;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .batch-btn:hover {
            background: #3b82f6;
            color: white;
        }
        
        .batch-btn.danger {
            border-color: #dc2626;
            color: #dc2626;
        }
        
        .batch-btn.danger:hover {
            background: #dc2626;
            color: white;
        }
        
        .result-tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
            gap: 4px;
        }
        
        .result-tab {
            padding: 12px 20px;
            border: none;
            background: none;
            color: var(--tibetan-brown);
            font-size: 0.9rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .result-tab.active {
            color: var(--tibetan-red);
            border-bottom-color: var(--tibetan-gold);
            font-weight: 600;
            background: linear-gradient(135deg, rgba(218, 165, 32, 0.1), rgba(255, 140, 0, 0.1));
        }
        
        .result-tab:hover {
            color: var(--tibetan-red);
            background: rgba(218, 165, 32, 0.05);
        }
        
        .result-tab .tab-badge {
            background: var(--tibetan-gold);
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.75rem;
            margin-left: 6px;
            min-width: 20px;
            text-align: center;
        }
        
        .result-panels {
            position: relative;
        }
        
        .result-panel {
            display: none;
        }
        
        .result-panel.active {
            display: block !important;
            animation: fadeInUp 0.3s ease;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            max-height: 500px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* å›¾ç‰‡ç½‘æ ¼æ»šåŠ¨æ¡æ ·å¼ */
        .image-grid::-webkit-scrollbar {
            width: 8px;
        }
        
        .image-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 4px;
        }
        
        .image-grid::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--tibetan-gold), var(--tibetan-orange));
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        
        .image-grid::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--tibetan-orange), var(--tibetan-red));
        }
        
        .image-item {
            background: white;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--tibetan-cream);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .image-item:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
            border-color: var(--tibetan-gold);
        }
        
        .image-item img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: transform 0.3s ease;
        }
        
        /* æ”¾å¤§é•œæ•ˆæœ */
        .image-item:hover img {
            transform: scale(1.1);
        }
        
        .image-item::before {
            content: 'ğŸ”';
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 6px 8px;
            border-radius: 50%;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        
        .image-item.pdf-file {
            border: 2px solid var(--tibetan-purple);
            background: linear-gradient(135deg, rgba(175, 122, 197, 0.1), rgba(255, 255, 255, 0.9));
        }
        
        .image-item.pdf-file::before {
            content: 'ğŸ“„';
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--tibetan-purple);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            z-index: 10;
        }
        
        .image-item:hover::before {
            opacity: 1;
        }
        
        .image-info {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 4px;
        }
        
        .image-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-pending {
            background: var(--tibetan-cream);
            color: var(--tibetan-brown);
        }
        
        .status-processing {
            background: linear-gradient(135deg, var(--tibetan-blue), var(--tibetan-purple));
            color: white;
        }
        
        .status-completed {
            background: linear-gradient(135deg, var(--tibetan-gold), var(--tibetan-orange));
            color: white;
        }
        
        .status-error {
            background: linear-gradient(135deg, var(--tibetan-red), var(--tibetan-maroon));
            color: white;
        }
        
        .combined-result {
            background: linear-gradient(135deg, white 0%, var(--tibetan-cream) 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--tibetan-gold);
        }
        
        .combined-result h4 {
            margin-bottom: 16px;
            color: var(--tibetan-red);
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .combined-result .text-content {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--tibetan-cream);
            border-radius: 12px;
            padding: 20px;
            font-family: 'FangZheng-Zangyi', 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.95rem;
            color: var(--tibetan-brown);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            /* æ·»åŠ æ»šåŠ¨æ¡æ”¯æŒ */
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        /* åˆå¹¶ç»“æœæ»šåŠ¨æ¡æ ·å¼ */
        .combined-result .text-content::-webkit-scrollbar {
            width: 10px;
        }
        
        .combined-result .text-content::-webkit-scrollbar-track {
            background: var(--tibetan-cream);
            border-radius: 5px;
            margin: 4px;
        }
        
        .combined-result .text-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--tibetan-gold), var(--tibetan-orange));
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        
        .combined-result .text-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--tibetan-red), var(--tibetan-maroon));
        }
        
        /* å¤„ç†æ—¶é—´æ˜¾ç¤ºæ ·å¼ */
        .processing-time {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.8));
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .time-label {
            font-size: 0.9rem;
            color: var(--tibetan-brown);
            font-weight: 500;
        }
        
        .time-display {
            font-size: 0.9rem;
            font-weight: 600;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
            padding: 2px 8px;
            border-radius: 12px;
            background: white;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            min-width: 70px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .time-display.fast {
            color: #10b981; /* ç»¿è‰² - å¿« */
            background: rgba(16, 185, 129, 0.1);
        }
        
        .time-display.medium {
            color: #f59e0b; /* æ©™è‰² - ä¸­ */
            background: rgba(245, 158, 11, 0.1);
        }
        
        .time-display.slow {
            color: #ef4444; /* çº¢è‰² - æ…¢ */
            background: rgba(239, 68, 68, 0.1);
        }
        
        @media (max-width: 768px) {
            .processing-time {
                padding: 4px 8px;
            }
            
            .time-label {
                font-size: 0.8rem;
            }
            
            .time-display {
                font-size: 0.8rem;
                min-width: 60px;
            }
        }
        
        .result-separator {
            border-top: 2px dashed #e2e8f0;
            margin: 16px 0;
            position: relative;
        }
        
        .result-separator::after {
            content: attr(data-filename);
            background: white;
            color: #64748b;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            position: absolute;
            left: 50%;
            top: -10px;
            transform: translateX(-50%);
            border: 1px solid #e2e8f0;
        }

        .progress-section {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .progress-modal {
            background: white;
            border-radius: 24px;
            padding: 40px 50px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            min-width: 400px;
            max-width: 500px;
            animation: slideInUp 0.4s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .progress-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: rotateGlow 2s ease-in-out infinite;
        }

        @keyframes rotateGlow {
            0%, 100% {
                transform: rotate(0deg);
                filter: brightness(1);
            }
            50% {
                transform: rotate(180deg);
                filter: brightness(1.2) drop-shadow(0 0 10px rgba(102, 126, 234, 0.6));
            }
        }

        .progress-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .progress-subtitle {
            font-size: 1rem;
            color: #64748b;
            margin-bottom: 30px;
        }

        .progress-bar-container {
            position: relative;
            width: 100%;
            height: 8px;
            background: #f1f5f9;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                var(--tibetan-gold) 0%, 
                var(--tibetan-orange) 50%, 
                var(--tibetan-red) 100%);
            background-size: 200% 100%;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            position: relative;
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 20px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 50%, 
                transparent 100%);
            animation: slideProgress 1.5s ease-in-out infinite;
        }

        @keyframes slideProgress {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        .progress-percentage {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--tibetan-red);
            margin-bottom: 16px;
        }

        .progress-status {
            font-size: 0.95rem;
            color: #475569;
            margin-bottom: 20px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .progress-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
            color: #374151;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .progress-btn:hover {
            background: #f9fafb;
            border-color: #667eea;
        }

        .progress-btn.primary {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .progress-btn.primary:hover {
            background: #5a6fd8;
        }

        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
            margin-right: 12px;
        }

        /* é¡µé¢åŠ è½½åŠ¨ç”» */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header {
            animation: slideInDown 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .upload-section {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
        }

        .language-section {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
        }

        .quick-mode {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.4s both;
        }

        /* æ‚¬æµ®ç²’å­æ•ˆæœ */
        .header::after {
            content: '';
            position: absolute;
            top: 20%;
            right: 10%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* æ¸å˜æ–‡å­—æ•ˆæœ */
        .upload-section p {
            background: linear-gradient(45deg, #64748b, #475569);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ç„¦ç‚¹å¯è®¿é—®æ€§ */
        button:focus-visible,
        select:focus-visible,
        input:focus-visible {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        @media (max-width: 1200px) {
            .content {
                grid-template-columns: 1fr;
                gap: 24px;
                padding: 24px;
            }
            
            .controls-panel {
                order: -1;
                position: static;
                margin-bottom: 24px;
            }
            
            .result-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .features {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .arrow-hint {
                flex-direction: column;
                gap: 8px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .header {
                padding: 20px 24px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 16px;
            }
            
            .controls-panel {
                padding: 20px;
            }
            
            .welcome-content {
                padding: 20px;
            }
            
            .welcome-content h2 {
                font-size: 1.5rem;
            }
            
            .welcome-icon {
                font-size: 3rem;
            }
        }

        /* é¡¶éƒ¨é€šçŸ¥ç³»ç»Ÿ */
        .notification-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            pointer-events: none;
        }

        .notification {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 12px;
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.1),
                0 4px 12px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 500px;
            pointer-events: auto;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideInDown 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideOutUp {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
        }

        .notification.slide-out {
            animation: slideOutUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .notification-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 2px;
            color: #1e293b;
        }

        .notification-message {
            font-size: 0.85rem;
            color: #64748b;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #94a3b8;
            cursor: pointer;
            padding: 4px;
            border-radius: 6px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .notification-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #64748b;
        }

        /* ä¸åŒç±»å‹çš„é€šçŸ¥æ ·å¼ */
        .notification.success {
            border-left: 4px solid #10b981;
        }

        .notification.success .notification-icon {
            color: #10b981;
        }

        .notification.error {
            border-left: 4px solid #ef4444;
        }

        .notification.error .notification-icon {
            color: #ef4444;
        }

        .notification.info {
            border-left: 4px solid #3b82f6;
        }

        .notification.info .notification-icon {
            color: #3b82f6;
        }

        .notification.warning {
            border-left: 4px solid #f59e0b;
        }

        .notification.warning .notification-icon {
            color: #f59e0b;
        }
    </style>
</head>
<body >
    <!-- é¡¶éƒ¨é€šçŸ¥å®¹å™¨ -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <div class="container">
        <div class="header">
            <h1>æ™ºèƒ½æ–‡å­—è¯†åˆ«å·¥å…·-à½¢à½²à½‚à¼‹à½“à½´à½¦à¼‹à½¡à½²à¼‹à½‚à½ºà¼‹à½„à½¼à½¦à¼‹à½ à½›à½²à½“à¼‹à½˜à¼‹à½£à½‚à¼</h1>
            <!-- <p>æ”¯æŒè—æ–‡ã€ä¸­æ–‡ã€è‹±æ–‡ç­‰ 100+ ç§è¯­è¨€ï¼Œä¸€é”®æå–å›¾ç‰‡ä¸­çš„æ–‡å­—</p> -->
            <p>à½–à½¼à½‘à¼‹à½¡à½²à½‚à¼‹à½‘à½„à¼‹à¼ à½¢à¾’à¾±à¼‹à½¡à½²à½‚à¼ à½‘à½–à¾±à½²à½“à¼‹à½¡à½²à½‚à¼‹à½¦à½¼à½‚à½¦à¼‹à½¦à¾à½‘à¼‹à½¢à½²à½‚à½¦à¼‹100+à½¢à½²à½‚à½¦à¼‹à½£à¼‹à½¢à¾’à¾±à½–à¼‹à½¦à¾à¾±à½¼à½¢à¼‹à½–à¾±à½ºà½‘à¼ à½˜à½à½ºà½–à¼‹à½‚à½…à½²à½‚à¼‹à½‚à½²à½¦à¼‹à½”à½¢à¼‹à½¢à½²à½¦à¼‹à½“à½„à¼‹à½‚à½²à¼‹à½¡à½²à¼‹à½‚à½ºà¼‹à½•à¾±à½²à½¢à¼‹à½ à½‘à½¼à½“à¼‹à½–à¾±à½ºà½‘à¼‹à½à½´à½–à¼</p>
        </div>

        <div class="content">
            <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
            <div class="main-area">
                <!-- æ¬¢è¿æ¶ˆæ¯ -->
                <div class="welcome-message" id="welcomeMessage">
                    <div class="welcome-content">
                        <div class="welcome-icon">ğŸš€</div>
                        <h2>æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æ–‡å­—è¯†åˆ«å·¥å…·</h2>
                        <p>æ”¯æŒè—æ–‡ã€ä¸­æ–‡ã€è‹±æ–‡ç­‰ 100+ ç§è¯­è¨€çš„æ–‡å­—è¯†åˆ«</p>
                        <div class="features">
                            <div class="feature-item">
                                <span class="feature-icon">ğŸŒ</span>
                                <span>å¤šè¯­è¨€æ”¯æŒ</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">âš¡</span>
                                <span>å¿«é€Ÿè¯†åˆ«</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ğŸ¨</span>
                                <span>é«˜ç²¾åº¦è¯†åˆ«</span>
                            </div>
                        </div>
                        <div class="arrow-hint">
                            <span>è¯·åœ¨å³ä¾§é¢æ¿é€‰æ‹©å›¾ç‰‡æ–‡ä»¶å¼€å§‹è¯†åˆ«</span>
                            <div class="arrow">â¡ï¸</div>
                        </div>
                    </div>
                </div>
                
                <!-- æ‰¹é‡å¤„ç†ä¿¡æ¯é¢æ¿ -->
                <div class="batch-info" id="batchInfo">
                    <div class="batch-summary">
                        <div class="batch-title">ğŸ“ æ‰¹é‡è¯†åˆ«è¿›è¡Œä¸­</div>
                        <div class="batch-progress" id="batchProgress">0/0 å®Œæˆ</div>
                    </div>
                    <div class="batch-actions">
                        <button class="batch-btn" onclick="pauseBatchProcessing()">æš‚åœ</button>
                        <button class="batch-btn danger" onclick="cancelBatchProcessing()">å–æ¶ˆ</button>
                    </div>
                </div>
                
                <!-- è¿›åº¦æ˜¾ç¤ºæ¨¡æ€æ¡† -->
                <div class="progress-section" id="progressSection">
                    <div class="progress-modal">
                        <div class="progress-icon" id="progressIcon">ğŸ”„</div>
                        <div class="progress-title" id="progressTitle">æ­£åœ¨å¤„ç†...</div>
                        <div class="progress-subtitle" id="progressSubtitle">è¯·ç¨å€™ï¼Œæˆ‘ä»¬æ­£åœ¨è¯†åˆ«æ‚¨çš„å›¾ç‰‡</div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="progressFill"></div>
                        </div>
                        
                        <div class="progress-percentage" id="progressPercentage">0%</div>
                        <div class="progress-status" id="progressStatus">å‡†å¤‡ä¸­...</div>
                        
                        <div class="progress-actions" id="progressActions" style="display: none;">
                            <button class="progress-btn" onclick="cancelLoading()">å–æ¶ˆ</button>
                            <button class="progress-btn primary" onclick="switchToEnglish()" id="switchBtn" style="display: none;">åˆ‡æ¢åˆ°è‹±è¯­</button>
                        </div>
                    </div>
                </div>

                <!-- ç»“æœæ˜¾ç¤º -->
                <div class="results-section" id="resultsSection">
                    <!-- ç»“æœæ ‡ç­¾é¡µ -->
                    <div class="result-tabs" id="resultTabs" style="display: none;">
                        <button class="result-tab active" data-tab="batch">
                            ğŸ–¼ï¸ å¾…è¯†åˆ«æ–‡ä»¶ <span class="tab-badge" id="batchCount">0</span>
                        </button>
                        <button class="result-tab" data-tab="combined">
                            ğŸ“¦ è¯†åˆ«ç»“æœ <span class="tab-badge" id="combinedCount">0</span>
                        </button>
                    </div>
                    
                    <!-- ç»“æœé¢æ¿ -->
                    <div class="result-panels">
                        <!-- è¯†åˆ«ç»“æœé¢æ¿ -->
                        <div class="result-panel active" id="batchPanel">
                            <div class="image-grid" id="imageGrid">
                                <!-- æ‰¹é‡å¤„ç†çš„å›¾ç‰‡å’Œç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                        </div>
                        
                        <!-- åˆå¹¶ç»“æœé¢æ¿ -->
                        <div class="result-panel" id="combinedPanel">
                            <div class="combined-result">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                    <h4 style="margin: 0; color: var(--tibetan-red); font-size: 1.2rem; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                        ğŸ“¦ æ‰€æœ‰å›¾ç‰‡çš„åˆå¹¶è¯†åˆ«ç»“æœ
                                    </h4>
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <div class="processing-time">
                                            <span class="time-label">â±ï¸ è¯†åˆ«ç”¨æ—¶ï¼š</span>
                                            <span id="processingTimeDisplay" class="time-display">0.00 ç§’</span>
                                        </div>
                                        <div class="result-actions">
                                            <button class="action-btn copy-btn" onclick="copyResult()" title="å¤åˆ¶ç»“æœ">
                                                ğŸ“‹ å¤åˆ¶
                                            </button>
                                            <button class="action-btn save-btn" onclick="saveResult()" title="ä¿å­˜ä¸ºTXTæ–‡ä»¶">
                                                ğŸ’¾ ä¿å­˜
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-content" id="combinedResult">åˆå¹¶ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="controls-panel">
                <h2>ğŸš€ å¼€å§‹è¯†åˆ«</h2>
                
                <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-section" id="uploadSection">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                        ğŸ“ é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
                    </button>
                    <input type="file" id="fileInput" class="file-input" accept="image/*,.pdf" multiple>
                    <p>æˆ–æ‹–æ‹½åˆ°æ­¤åŒºåŸŸ</p>
                    <p style="color: #666; font-size: 0.8rem; margin-top: 8px;">
                        æ”¯æŒ PNG, JPG, GIF, BMP, PDF ç­‰æ ¼å¼<br>
                        <strong>âœ¨ æ”¯æŒå¤šå¼ å›¾ç‰‡å’Œ PDF æ–‡ä»¶åŒæ—¶è¯†åˆ«</strong>
                    </p>
                </div>
                
                <div class="divider"></div>
                
                <!-- è¯­è¨€é€‰æ‹© -->
                <div class="language-section">
                    <label for="languageSelect">é€‰æ‹©è¯†åˆ«è¯­è¨€ï¼š</label>
                    <select id="languageSelect" class="language-select">
                        <option value="bod" selected>ğŸ‡¹ğŸ‡§ è—æ–‡ (Tibetan)</option>
                        <option value="eng">ğŸ‡¬ğŸ‡§ è‹±è¯­ (English)</option>
                        <option value="chi_sim">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                        <option value="chi_tra">ğŸ‡¨ğŸ‡³ ç¹ä½“ä¸­æ–‡</option>
                        <option value="jpn">ğŸ‡¯ğŸ‡µ æ—¥è¯­ (Japanese)</option>
                        <option value="kor">ğŸ‡°ğŸ‡· éŸ©è¯­ (Korean)</option>
                        <option value="ara">ğŸ‡¸ğŸ‡¦ é˜¿æ‹‰ä¼¯è¯­ (Arabic)</option>
                        <option value="hin">ğŸ‡®ğŸ‡³ å°åœ°è¯­ (Hindi)</option>
                        <option value="rus">ğŸ‡·ğŸ‡º ä¿„è¯­ (Russian)</option>
                        <option value="fra">ğŸ‡«ğŸ‡· æ³•è¯­ (French)</option>
                        <option value="deu">ğŸ‡©ğŸ‡ª å¾·è¯­ (German)</option>
                        <option value="spa">ğŸ‡ªğŸ‡¸ è¥¿ç­ç‰™è¯­ (Spanish)</option>
                        <option value="tha">ğŸ‡¹ğŸ‡­ æ³°è¯­ (Thai)</option>
                        <option value="vie">ğŸ‡»ğŸ‡³ è¶Šå—è¯­ (Vietnamese)</option>
                        <option value="eng+chi_sim">ğŸ‡¬ğŸ‡§+ğŸ‡¨ğŸ‡³ è‹±è¯­+ç®€ä½“ä¸­æ–‡</option>
                        <option value="eng+bod">ğŸ‡¬ğŸ‡§+ğŸ‡¹ğŸ‡§ è‹±è¯­+è—æ–‡</option>
                        <option value="chi_sim+bod">ğŸ‡¨ğŸ‡³+ğŸ‡¹ğŸ‡§ ç®€ä½“ä¸­æ–‡+è—æ–‡</option>
                        <!-- æ–°å¢100ç§è¯­è¨€é€‰é¡¹ -->
                        <option value="afr">ğŸ‡¿ğŸ‡¦ å—éè·å…°è¯­ (Afrikaans)</option>
                        <option value="amh">ğŸ‡ªğŸ‡¹ é˜¿å§†å“ˆæ‹‰è¯­ (Amharic)</option>
                        <option value="asm">ğŸ‡®ğŸ‡³ é˜¿è¨å§†è¯­ (Assamese)</option>
                        <option value="aze">ğŸ‡¦ğŸ‡¿ é˜¿å¡æ‹œç–†è¯­ (Azerbaijani)</option>
                        <option value="aze_cyrl">ğŸ‡¦ğŸ‡¿ é˜¿å¡æ‹œç–†è¯­-è¥¿é‡Œå°”æ–‡ (Azerbaijani - Cyrillic)</option>
                        <option value="bel">ğŸ‡§ğŸ‡¾ ç™½ä¿„ç½—æ–¯è¯­ (Belarusian)</option>
                        <option value="ben">ğŸ‡§ğŸ‡© å­ŸåŠ æ‹‰è¯­ (Bengali)</option>
                        <option value="bos">ğŸ‡§ğŸ‡¦ æ³¢æ–¯å°¼äºšè¯­ (Bosnian)</option>
                        <option value="bul">ğŸ‡§ğŸ‡¬ ä¿åŠ åˆ©äºšè¯­ (Bulgarian)</option>
                        <option value="cat">ğŸ‡ªğŸ‡¸ åŠ æ³°ç½—å°¼äºšè¯­ (Catalan)</option>
                        <option value="ceb">ğŸ‡µğŸ‡­ å®¿åŠ¡è¯­ (Cebuano)</option>
                        <option value="ces">ğŸ‡¨ğŸ‡¿ æ·å…‹è¯­ (Czech)</option>
                        <option value="chr">ğŸ‡ºğŸ‡¸ åˆ‡ç½—åŸºè¯­ (Cherokee)</option>
                        <option value="cym">ğŸ‡¬ğŸ‡§ å¨å°”å£«è¯­ (Welsh)</option>
                        <option value="dan">ğŸ‡©ğŸ‡° ä¸¹éº¦è¯­ (Danish)</option>
                        <option value="dzo">ğŸ‡§ğŸ‡¹ å®—å–€è¯­ (Dzongkha)</option>
                        <option value="ell">ğŸ‡¬ğŸ‡· å¸Œè…Šè¯­ (Greek)</option>
                        <option value="enm">ğŸ‡¬ğŸ‡§ ä¸­å¤è‹±è¯­ (Middle English)</option>
                        <option value="epo"> Esperanto (ä¸–ç•Œè¯­)</option>
                        <option value="est">ğŸ‡ªğŸ‡ª çˆ±æ²™å°¼äºšè¯­ (Estonian)</option>
                        <option value="eus">ğŸ‡ªğŸ‡¸ å·´æ–¯å…‹è¯­ (Basque)</option>
                        <option value="fas">ğŸ‡®ğŸ‡· æ³¢æ–¯è¯­ (Persian)</option>
                        <option value="fin">ğŸ‡«ğŸ‡® èŠ¬å…°è¯­ (Finnish)</option>
                        <option value="frk">ğŸ‡©ğŸ‡ª å¾·è¯­å“¥ç‰¹ä½“ (German Fraktur)</option>
                        <option value="frm">ğŸ‡«ğŸ‡· ä¸­å¤æ³•è¯­ (Middle French)</option>
                        <option value="gle">ğŸ‡®ğŸ‡ª çˆ±å°”å…°è¯­ (Irish)</option>
                        <option value="glg">ğŸ‡ªğŸ‡¸ åŠ åˆ©è¥¿äºšè¯­ (Galician)</option>
                        <option value="grc">ğŸ‡¬ğŸ‡· å¤å¸Œè…Šè¯­ (Ancient Greek)</option>
                        <option value="guj">ğŸ‡®ğŸ‡³ å¤å‰æ‹‰ç‰¹è¯­ (Gujarati)</option>
                        <option value="hat">ğŸ‡­ğŸ‡¹ æµ·åœ°å…‹é‡Œå¥¥å°”è¯­ (Haitian Creole)</option>
                        <option value="heb">ğŸ‡®ğŸ‡± å¸Œä¼¯æ¥è¯­ (Hebrew)</option>
                        <option value="hrv">ğŸ‡­ğŸ‡· å…‹ç½—åœ°äºšè¯­ (Croatian)</option>
                        <option value="hun">ğŸ‡­ğŸ‡º åŒˆç‰™åˆ©è¯­ (Hungarian)</option>
                        <option value="iku">ğŸ‡¨ğŸ‡¦ ä¼ŠåŠªå…‹æå›¾ç‰¹è¯­ (Inuktitut)</option>
                        <option value="ind">ğŸ‡®ğŸ‡© å°åº¦å°¼è¥¿äºšè¯­ (Indonesian)</option>
                        <option value="isl">ğŸ‡®ğŸ‡¸ å†°å²›è¯­ (Icelandic)</option>
                        <option value="ita">ğŸ‡®ğŸ‡¹ æ„å¤§åˆ©è¯­ (Italian)</option>
                        <option value="ita_old">ğŸ‡®ğŸ‡¹ å¤æ„å¤§åˆ©è¯­ (Old Italian)</option>
                        <option value="jav">ğŸ‡®ğŸ‡© çˆªå“‡è¯­ (Javanese)</option>
                        <option value="kan">ğŸ‡®ğŸ‡³ å¡çº³è¾¾è¯­ (Kannada)</option>
                        <option value="kat">ğŸ‡¬ğŸ‡ª æ ¼é²å‰äºšè¯­ (Georgian)</option>
                        <option value="kat_old">ğŸ‡¬ğŸ‡ª å¤æ ¼é²å‰äºšè¯­ (Old Georgian)</option>
                        <option value="kaz">ğŸ‡°ğŸ‡¿ å“ˆè¨å…‹è¯­ (Kazakh)</option>
                        <option value="khm">ğŸ‡°ğŸ‡­ é«˜æ£‰è¯­ (Khmer)</option>
                        <option value="kir">ğŸ‡°ğŸ‡¬ å‰å°”å‰æ–¯è¯­ (Kyrgyz)</option>
                        <option value="kur">ğŸ‡®ğŸ‡¶ åº“å°”å¾·è¯­ (Kurdish)</option>
                        <option value="lao">ğŸ‡±ğŸ‡¦ è€æŒè¯­ (Lao)</option>
                        <option value="lat">ğŸ‡»ğŸ‡¦ æ‹‰ä¸è¯­ (Latin)</option>
                        <option value="lav">ğŸ‡±ğŸ‡» æ‹‰è„±ç»´äºšè¯­ (Latvian)</option>
                        <option value="lit">ğŸ‡±ğŸ‡¹ ç«‹é™¶å®›è¯­ (Lithuanian)</option>
                        <option value="mal">ğŸ‡®ğŸ‡³ é©¬æ‹‰é›…æ‹‰å§†è¯­ (Malayalam)</option>
                        <option value="mar">ğŸ‡®ğŸ‡³ é©¬æ‹‰åœ°è¯­ (Marathi)</option>
                        <option value="mkd">ğŸ‡²ğŸ‡° é©¬å…¶é¡¿è¯­ (Macedonian)</option>
                        <option value="mlt">ğŸ‡²ğŸ‡¹ é©¬è€³ä»–è¯­ (Maltese)</option>
                        <option value="msa">ğŸ‡²ğŸ‡¾ é©¬æ¥è¯­ (Malay)</option>
                        <option value="mya">ğŸ‡²ğŸ‡² ç¼…ç”¸è¯­ (Burmese)</option>
                        <option value="nep">ğŸ‡³ğŸ‡µ å°¼æ³Šå°”è¯­ (Nepali)</option>
                        <option value="nld">ğŸ‡³ğŸ‡± è·å…°è¯­ (Dutch)</option>
                        <option value="nor">ğŸ‡³ğŸ‡´ æŒªå¨è¯­ (Norwegian)</option>
                        <option value="ori">ğŸ‡®ğŸ‡³ å¥¥é‡Œäºšè¯­ (Oriya)</option>
                        <option value="pan">ğŸ‡®ğŸ‡³ æ—é®æ™®è¯­ (Punjabi)</option>
                        <option value="pol">ğŸ‡µğŸ‡± æ³¢å…°è¯­ (Polish)</option>
                        <option value="por">ğŸ‡µğŸ‡¹ è‘¡è„ç‰™è¯­ (Portuguese)</option>
                        <option value="pus">ğŸ‡¦ğŸ‡« æ™®ä»€å›¾è¯­ (Pashto)</option>
                        <option value="ron">ğŸ‡·ğŸ‡´ ç½—é©¬å°¼äºšè¯­ (Romanian)</option>
                        <option value="san">ğŸ‡®ğŸ‡³ æ¢µè¯­ (Sanskrit)</option>
                        <option value="sin">ğŸ‡±ğŸ‡° åƒ§ä¼½ç½—è¯­ (Sinhala)</option>
                        <option value="slk">ğŸ‡¸ğŸ‡° æ–¯æ´›ä¼å…‹è¯­ (Slovak)</option>
                        <option value="slv">ğŸ‡¸ğŸ‡® æ–¯æ´›æ–‡å°¼äºšè¯­ (Slovenian)</option>
                        <option value="spa_old">ğŸ‡ªğŸ‡¸ å¤è¥¿ç­ç‰™è¯­ (Old Spanish)</option>
                        <option value="sqi">ğŸ‡¦ğŸ‡± é˜¿å°”å·´å°¼äºšè¯­ (Albanian)</option>
                        <option value="srp">ğŸ‡·ğŸ‡¸ å¡å°”ç»´äºšè¯­ (Serbian)</option>
                        <option value="srp_latn">ğŸ‡·ğŸ‡¸ å¡å°”ç»´äºšè¯­-æ‹‰ä¸æ–‡ (Serbian - Latin)</option>
                        <option value="swa">ğŸ‡°ğŸ‡ª æ–¯ç“¦å¸Œé‡Œè¯­ (Swahili)</option>
                        <option value="swe">ğŸ‡¸ğŸ‡ª ç‘å…¸è¯­ (Swedish)</option>
                        <option value="syr">ğŸ‡¸ğŸ‡¾ å™åˆ©äºšè¯­ (Syriac)</option>
                        <option value="tam">ğŸ‡®ğŸ‡³ æ³°ç±³å°”è¯­ (Tamil)</option>
                        <option value="tel">ğŸ‡®ğŸ‡³ æ³°å¢å›ºè¯­ (Telugu)</option>
                        <option value="tgk">ğŸ‡¹ğŸ‡¯ å¡”å‰å…‹è¯­ (Tajik)</option>
                        <option value="tgl">ğŸ‡µğŸ‡­ ä»–åŠ ç¦„è¯­ (Tagalog)</option>
                        <option value="tir">ğŸ‡ªğŸ‡¹ ææ ¼åˆ©å°¼äºšè¯­ (Tigrinya)</option>
                        <option value="tur">ğŸ‡¹ğŸ‡· åœŸè€³å…¶è¯­ (Turkish)</option>
                        <option value="uig">ğŸ‡¨ğŸ‡³ ç»´å¾å°”è¯­ (Uyghur)</option>
                        <option value="ukr">ğŸ‡ºğŸ‡¦ ä¹Œå…‹å…°è¯­ (Ukrainian)</option>
                        <option value="urd">ğŸ‡µğŸ‡° ä¹Œå°”éƒ½è¯­ (Urdu)</option>
                        <option value="uzb">ğŸ‡ºğŸ‡¿ ä¹Œå…¹åˆ«å…‹è¯­ (Uzbek)</option>
                        <option value="uzb_cyrl">ğŸ‡ºğŸ‡¿ ä¹Œå…¹åˆ«å…‹è¯­-è¥¿é‡Œå°”æ–‡ (Uzbek - Cyrillic)</option>
                        <option value="yid">ğŸ‡®ğŸ‡± æ„ç¬¬ç»ªè¯­ (Yiddish)</option>
                        <!-- å¤šè¯­è¨€ç»„åˆ -->
                        <option value="eng+fra">ğŸ‡¬ğŸ‡§+ğŸ‡«ğŸ‡· è‹±è¯­+æ³•è¯­</option>
                        <option value="eng+deu">ğŸ‡¬ğŸ‡§+ğŸ‡©ğŸ‡ª è‹±è¯­+å¾·è¯­</option>
                        <option value="eng+spa">ğŸ‡¬ğŸ‡§+ğŸ‡ªğŸ‡¸ è‹±è¯­+è¥¿ç­ç‰™è¯­</option>
                        <option value="eng+jpn">ğŸ‡¬ğŸ‡§+ğŸ‡¯ğŸ‡µ è‹±è¯­+æ—¥è¯­</option>
                        <option value="eng+kor">ğŸ‡¬ğŸ‡§+ğŸ‡°ğŸ‡· è‹±è¯­+éŸ©è¯­</option>
                        <option value="eng+rus">ğŸ‡¬ğŸ‡§+ğŸ‡·ğŸ‡º è‹±è¯­+ä¿„è¯­</option>
                        <option value="eng+ara">ğŸ‡¬ğŸ‡§+ğŸ‡¸ğŸ‡¦ è‹±è¯­+é˜¿æ‹‰ä¼¯è¯­</option>
                        <option value="chi_sim+chi_tra">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡+ç¹ä½“ä¸­æ–‡</option>
                        <option value="chi_sim+jpn">ğŸ‡¨ğŸ‡³+ğŸ‡¯ğŸ‡µ ç®€ä½“ä¸­æ–‡+æ—¥è¯­</option>
                        <option value="chi_sim+kor">ğŸ‡¨ğŸ‡³+ğŸ‡°ğŸ‡· ç®€ä½“ä¸­æ–‡+éŸ©è¯­</option>
                        <option value="fra+deu">ğŸ‡«ğŸ‡·+ğŸ‡©ğŸ‡ª æ³•è¯­+å¾·è¯­</option>
                        <option value="fra+spa">ğŸ‡«ğŸ‡·+ğŸ‡ªğŸ‡¸ æ³•è¯­+è¥¿ç­ç‰™è¯­</option>
                        <option value="deu+spa">ğŸ‡©ğŸ‡ª+ğŸ‡ªğŸ‡¸ å¾·è¯­+è¥¿ç­ç‰™è¯­</option>
                        <option value="jpn+kor">ğŸ‡¯ğŸ‡µ+ğŸ‡°ğŸ‡· æ—¥è¯­+éŸ©è¯­</option>
                        <option value="eng+chi_sim+jpn">ğŸ‡¬ğŸ‡§+ğŸ‡¨ğŸ‡³+ğŸ‡¯ğŸ‡µ è‹±è¯­+ç®€ä½“ä¸­æ–‡+æ—¥è¯­</option>
                        <option value="eng+chi_sim+fra">ğŸ‡¬ğŸ‡§+ğŸ‡¨ğŸ‡³+ğŸ‡«ğŸ‡· è‹±è¯­+ç®€ä½“ä¸­æ–‡+æ³•è¯­</option>
                        <option value="eng+chi_sim+deu">ğŸ‡¬ğŸ‡§+ğŸ‡¨ğŸ‡³+ğŸ‡©ğŸ‡ª è‹±è¯­+ç®€ä½“ä¸­æ–‡+å¾·è¯­</option>
                        <option value="eng+chi_sim+spa">ğŸ‡¬ğŸ‡§+ğŸ‡¨ğŸ‡³+ğŸ‡ªğŸ‡¸ è‹±è¯­+ç®€ä½“ä¸­æ–‡+è¥¿ç­ç‰™è¯­</option>
                        <option value="eng+chi_sim+rus">ğŸ‡¬ğŸ‡§+ğŸ‡¨ğŸ‡³+ğŸ‡·ğŸ‡º è‹±è¯­+ç®€ä½“ä¸­æ–‡+ä¿„è¯­</option>
                    </select>
                    <p style="color: #666; font-size: 0.8rem; margin-top: 5px;">
                        â„¹ï¸ æç¤ºï¼šè—æ–‡ç­‰å¤§æ–‡ä»¶é¦–æ¬¡ä¸‹è½½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…
                    </p>
                </div>
                


            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡å®šä¹‰
        let worker = null;
        let currentLanguage = 'bod';
        let isPreloading = false;
        
        // æ‰¹é‡å¤„ç†ç›¸å…³å˜é‡
        let batchQueue = [];
        let batchResults = [];
        let isProcessingBatch = false;
        let batchPaused = false;
        let currentBatchIndex = 0;
        
        // æ—¶é—´ç»Ÿè®¡å˜é‡
        let processingStartTime = 0;
        let processingTotalTime = 0;
        let batchStartTimes = {};
        
        // PDF.js åˆå§‹åŒ–
        // ç¡®ä¿PDF.jsåº“æ­£ç¡®åŠ è½½
        function initializePdfJs() {
            if (typeof pdfjsLib !== 'undefined') {
                console.log('PDF.js åº“å·²åŠ è½½');
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            } else {
                console.warn('PDF.js åº“æœªåŠ è½½ï¼Œå°è¯•é‡æ–°åŠ è½½...');
                // åŠ¨æ€åŠ è½½PDF.jsåº“
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';
                script.onload = function() {
                    console.log('PDF.js åº“åŠ è½½æˆåŠŸ');
                    if (typeof pdfjsLib !== 'undefined') {
                        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                    }
                };
                script.onerror = function() {
                    console.error('PDF.js åº“åŠ è½½å¤±è´¥');
                    showNotification('PDFåŠŸèƒ½ä¸å¯ç”¨', 'PDF.jsåº“åŠ è½½å¤±è´¥ï¼Œæ— æ³•å¤„ç†PDFæ–‡ä»¶', 'error');
                };
                document.head.appendChild(script);
            }
        }
        
        // èƒŒæ™¯è‰²æ–¹æ¡ˆæ•°ç»„
        const backgroundThemes = [
            // æŸ”å’Œæ—¥å‡º
            'linear-gradient(135deg, #FEF9E7 0%, #F1948A 25%, #5DADE2 50%, #AF7AC5 75%, #F4D03F 100%)',
            // æ¸©æš–å¤æ—¥
            'linear-gradient(135deg, #FEF9E7 0%, #F39C12 25%, #82E0AA 50%, #5DADE2 75%, #AF7AC5 100%)',
            // æ˜¥å¤©èŠ±æœµ
            'linear-gradient(135deg, #82E0AA 0%, #F1948A 25%, #F4D03F 50%, #AF7AC5 75%, #5DADE2 100%)',
            // ç§‹æ—¥æ¸©æš–
            'linear-gradient(135deg, #F4D03F 0%, #F39C12 25%, #CD5C5C 50%, #A0522D 75%, #FEF9E7 100%)',
            // æ¸…æ–°è–·è·
            'linear-gradient(135deg, #82E0AA 0%, #5DADE2 25%, #AF7AC5 50%, #F1948A 75%, #FEF9E7 100%)',
            // ç´«ç²‰æ¢¦å¢ƒ
            'linear-gradient(135deg, #AF7AC5 0%, #F1948A 25%, #F4D03F 50%, #82E0AA 75%, #5DADE2 100%)'
        ];
        
        // æ£€æµ‹å­—ä½“åŠ è½½
        function checkFontLoading() {
            if ('fonts' in document) {
                // ä½¿ç”¨ Font Loading API
                document.fonts.load('16px FangZheng-Zangyi').then(() => {
                    console.log('è—æ–‡å­—ä½“åŠ è½½æˆåŠŸ');
                    showNotification('å­—ä½“åŠ è½½æˆåŠŸ', 'æ–¹æ­£è—æ„æ±‰ä½“å·²æˆåŠŸåŠ è½½', 'success', 2000);
                }).catch(() => {
                    console.warn('è—æ–‡å­—ä½“åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨å­—ä½“');
                    showNotification('å­—ä½“åŠ è½½æç¤º', 'è‡ªå®šä¹‰å­—ä½“åŠ è½½ä¸­ï¼Œå°†ä½¿ç”¨ç³»ç»Ÿå¤‡ç”¨å­—ä½“', 'info', 3000);
                });
            } else {
                // å¤‡ç”¨æ–¹æ¡ˆï¼šç®€å•å»¶æ—¶æ£€æµ‹
                setTimeout(() => {
                    console.log('å­—ä½“åŠ è½½æ£€æµ‹å®Œæˆ');
                }, 1000);
            }
        }
        
        // è®¾ç½®éšæœºèƒŒæ™¯è‰²
        function setRandomBackground() {
            const randomIndex = Math.floor(Math.random() * backgroundThemes.length);
            document.body.style.background = backgroundThemes[randomIndex];
            console.log(`å·²åˆ‡æ¢åˆ°èƒŒæ™¯ä¸»é¢˜ ${randomIndex + 1}`);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== é¡µé¢DOMåŠ è½½å®Œæˆ ===');
            
            // æ£€æµ‹å­—ä½“åŠ è½½
            checkFontLoading();
            
            // è®¾ç½®éšæœºèƒŒæ™¯è‰²
            setRandomBackground();
            
            // åˆå§‹åŒ–PDF.js
            initializePdfJs();
            
            // æ£€æŸ¥Tesseractæ˜¯å¦å¯ç”¨
            if (typeof Tesseract === 'undefined') {
                console.error('Tesseract.jsæœªåŠ è½½');
                showError('Tesseract.js åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å¹¶åˆ·æ–°é¡µé¢');
                return;
            }
            
            console.log('=== Tesseract.jså·²åŠ è½½ ===');
            console.log('Tesseract å¯¹è±¡:', Tesseract);
            
            // è·å–DOMå…ƒç´ 
            const fileInput = document.getElementById('fileInput');
            const uploadSection = document.getElementById('uploadSection');
            const languageSelect = document.getElementById('languageSelect');
            
            console.log('=== DOMå…ƒç´ æ£€æŸ¥ ===');
            console.log('fileInput:', fileInput);
            console.log('uploadSection:', uploadSection);
            console.log('languageSelect:', languageSelect);

            if (!fileInput) {
                console.error('æ‰¾ä¸åˆ°æ–‡ä»¶è¾“å…¥å…ƒç´ ');
                showError('é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼šæ‰¾ä¸åˆ°æ–‡ä»¶è¾“å…¥å…ƒç´ ');
                return;
            }
            
            if (!uploadSection) {
                console.error('æ‰¾ä¸åˆ°ä¸Šä¼ åŒºåŸŸå…ƒç´ ');
                showError('é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼šæ‰¾ä¸åˆ°ä¸Šä¼ åŒºåŸŸå…ƒç´ ');
                return;
            }
            
            if (!languageSelect) {
                console.error('æ‰¾ä¸åˆ°è¯­è¨€é€‰æ‹©å™¨å…ƒç´ ');
                showError('é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼šæ‰¾ä¸åˆ°è¯­è¨€é€‰æ‹©å™¨å…ƒç´ ');
                return;
            }

            // é¢„åŠ è½½è—æ–‡æ¨¡å‹ï¼ˆæé«˜ç”¨æˆ·ä½“éªŒï¼‰
            preloadTibetan();

            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            console.log('=== æ·»åŠ æ–‡ä»¶é€‰æ‹©äº‹ä»¶ç›‘å¬å™¨ ===');
            fileInput.addEventListener('change', handleFileSelect);
            console.log('æ–‡ä»¶é€‰æ‹©äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ');
            
            // æµ‹è¯•ç‚¹å‡»äº‹ä»¶
            fileInput.addEventListener('click', function() {
                console.log('æ–‡ä»¶è¾“å…¥æ¡†è¢«ç‚¹å‡»');
            });
            
            // è¯­è¨€åˆ‡æ¢äº‹ä»¶
            languageSelect.addEventListener('change', function() {
                const newLang = this.value;
                console.log('è¯­è¨€åˆ‡æ¢åˆ°:', newLang);
                if (newLang !== currentLanguage) {
                    currentLanguage = newLang;
                    
                    if (worker && worker.currentLang !== currentLanguage) {
                        const langName = getLanguageName(newLang);
                        showNotification('è¯­è¨€å·²åˆ‡æ¢', `å·²åˆ‡æ¢åˆ°${langName}ï¼Œè¯†åˆ«æ—¶å°†é‡æ–°åŠ è½½è¯­è¨€åŒ…`, 'info');
                        terminateWorker();
                    }
                }
            });

            // è®¾ç½®æ‹–æ‹½ä¸Šä¼ 
            setupDragAndDrop();
            
            // æ·»åŠ ç‚¹å‡»ä¸Šä¼ åŒºåŸŸä¹Ÿèƒ½é€‰æ‹©æ–‡ä»¶
            uploadSection.addEventListener('click', function(e) {
                console.log('ä¸Šä¼ åŒºåŸŸè¢«ç‚¹å‡», ç›®æ ‡å…ƒç´ :', e.target.tagName);
                if (e.target.tagName !== 'BUTTON') {
                    console.log('è§¦å‘æ–‡ä»¶é€‰æ‹©...');
                    fileInput.click();
                }
            });
            
            console.log('=== åˆå§‹åŒ–å®Œæˆ ===');
            
            // æ·»åŠ æ ‡ç­¾é¡µç‚¹å‡»äº‹ä»¶
            setupResultTabs();
        });

        // è®¾ç½®æ‹–æ‹½ä¸Šä¼ 
        function setupDragAndDrop() {
            const uploadSection = document.getElementById('uploadSection');
            
            uploadSection.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadSection.classList.add('dragover');
            });

            uploadSection.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadSection.classList.remove('dragover');
            });

            uploadSection.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadSection.classList.remove('dragover');
                
                const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
                if (files.length > 0) {
                    if (files.length === 1) {
                        handleSingleFile(files[0]);
                    } else {
                        handleMultipleFiles(files);
                    }
                }
            });
        }

        // é‡ç½®æ‰¹é‡å¤„ç†
        function resetBatchProcessing() {
            batchQueue = [];
            batchResults = [];
            currentBatchIndex = 0;
            isProcessingBatch = false;
            batchPaused = false;
            
            // é‡ç½®å¤„ç†æ—¶é—´
            processingStartTime = 0;
            processingTotalTime = 0;
            batchStartTimes = {};
            
            const timeDisplay = document.getElementById('processingTimeDisplay');
            if (timeDisplay) {
                timeDisplay.textContent = '0.00 ç§’';
                timeDisplay.className = 'time-display';
            }
        }

        // åˆå§‹åŒ–æ‰¹é‡å¤„ç†
        function initBatchProcessing(files) {
            // é‡ç½®æ‰¹é‡å¤„ç†çŠ¶æ€
            batchQueue = files.map((file, index) => ({
                id: index,
                file: file,
                status: 'pending',
                result: null,
                error: null
            }));
            
            batchResults = [];
            currentBatchIndex = 0;
            isProcessingBatch = true;
            batchPaused = false;
            
            // é‡ç½®æ—¶é—´ç»Ÿè®¡
            processingStartTime = 0;
            processingTotalTime = 0;
            batchStartTimes = {};
            
            // æ›´æ–°è®¡æ•°å™¨
            updateTabCounts();
            updateBatchProgress();
            
            // åˆå§‹åŒ–å›¾ç‰‡ç½‘æ ¼
            initImageGrid();
            
            // éšè—æ¬¢è¿ä¿¡æ¯
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }
        }

        // å¤„ç†å•ä¸ªæ–‡ä»¶
        function handleSingleFile(file) {
            resetBatchProcessing();
            initBatchProcessing([file]);
            processNextFile();
        }

        // å¤„ç†å¤šä¸ªæ–‡ä»¶
        function handleMultipleFiles(files) {
            resetBatchProcessing();
            initBatchProcessing(files);
            processNextFile();
        }

        // å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶
        function processNextFile() {
            if (currentBatchIndex >= batchQueue.length) {
                isProcessingBatch = false;
                return;
            }

            const item = batchQueue[currentBatchIndex];
            if (item.status === 'pending') {
                item.status = 'processing';
                item.startTime = performance.now();
                processFile(item.file, (result, error) => {
                    item.result = result;
                    item.error = error;
                    item.endTime = performance.now();
                    item.status = 'completed';
                    batchResults.push(item);
                    updateBatchProgress();
                    processNextFile();
                });
            } else {
                currentBatchIndex++;
                processNextFile();
            }
        }

        // æ›´æ–°æ‰¹é‡å¤„ç†è¿›åº¦
        function updateBatchProgress() {
            const progressElement = document.getElementById('batchProgress');
            if (progressElement) {
                const completedCount = batchResults.filter(item => item.status === 'completed').length;
                progressElement.textContent = `${completedCount}/${batchQueue.length}`;
            }
        }

        // æ›´æ–°æ ‡ç­¾è®¡æ•°
        function updateTabCounts() {
            const pendingCount = batchQueue.filter(item => item.status === 'pending').length;
            const processingCount = batchQueue.filter(item => item.status === 'processing').length;
            const completedCount = batchResults.filter(item => item.status === 'completed').length;

            const pendingTab = document.getElementById('pendingTab');
            const processingTab = document.getElementById('processingTab');
            const completedTab = document.getElementById('completedTab');

            if (pendingTab) {
                pendingTab.textContent = `å¾…å¤„ç† (${pendingCount})`;
            }
            if (processingTab) {
                processingTab.textContent = `å¤„ç†ä¸­ (${processingCount})`;
            }
            if (completedTab) {
                completedTab.textContent = `å·²å®Œæˆ (${completedCount})`;
            }
        }

        // åˆå§‹åŒ–å›¾ç‰‡ç½‘æ ¼
        function initImageGrid() {
            const imageGrid = document.getElementById('imageGrid');
            if (imageGrid) {
                imageGrid.innerHTML = '';
                batchQueue.forEach(item => {
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'image-container';
                    imageContainer.id = `image-${item.id}`;

                    const image = document.createElement('img');
                    image.src = URL.createObjectURL(item.file);
                    image.alt = item.file.name;

                    imageContainer.appendChild(image);
                    imageGrid.appendChild(imageContainer);
                });
            }
        }

        // å¤„ç†æ–‡ä»¶
        function processFile(file, callback) {
            // æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†
            setTimeout(() => {
                const result = `Processed ${file.name}`;
                callback(result, null);
            }, 1000);
        }

        // åˆå§‹åŒ–ä¸Šä¼ åŒºåŸŸ
        function initUploadSection() {
            const uploadSection = document.getElementById('uploadSection');
            if (uploadSection) {
                uploadSection.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadSection.classList.add('dragover');
                });

                uploadSection.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('dragover');
                });

                uploadSection.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('dragover');
                    
                    const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
                    if (files.length > 0) {
                        if (files.length === 1) {
                            handleSingleFile(files[0]);
                        } else {
                            handleMultipleFiles(files);
                        }
                    }
                });
            }
        }

        // é‡ç½®æ‰¹é‡å¤„ç†
        function resetBatchProcessing() {
            batchQueue = [];
            batchResults = [];
            currentBatchIndex = 0;
            isProcessingBatch = false;
            batchPaused = false;
            
            // é‡ç½®å¤„ç†æ—¶é—´
            processingStartTime = 0;
            processingTotalTime = 0;
            batchStartTimes = {};
            
            const timeDisplay = document.getElementById('processingTimeDisplay');
            if (timeDisplay) {
                timeDisplay.textContent = '0.00 ç§’';
                timeDisplay.className = 'time-display';
            }
        }

        // åˆå§‹åŒ–æ‰¹é‡å¤„ç†
        function initBatchProcessing(files) {
            // é‡ç½®æ‰¹é‡å¤„ç†çŠ¶æ€
            batchQueue = files.map((file, index) => ({
                id: index,
                file: file,
                status: 'pending',
                result: null,
                error: null
            }));
            
            batchResults = [];
            currentBatchIndex = 0;
            isProcessingBatch = true;
            batchPaused = false;
            
            // é‡ç½®æ—¶é—´ç»Ÿè®¡
            processingStartTime = 0;
            processingTotalTime = 0;
            batchStartTimes = {};
            
            // æ›´æ–°è®¡æ•°å™¨
            updateTabCounts();
            updateBatchProgress();
            
            // åˆå§‹åŒ–å›¾ç‰‡ç½‘æ ¼
            initImageGrid();
            
            // éšè—æ¬¢è¿ä¿¡æ¯
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }
        }

        // å¤„ç†å•ä¸ªæ–‡ä»¶
        function handleSingleFile(file) {
            resetBatchProcessing();
            initBatchProcessing([file]);
            processNextBatch();
        }

        // å¤„ç†å¤šä¸ªæ–‡ä»¶
        function handleMultipleFiles(files) {
            resetBatchProcessing();
            initBatchProcessing(files);
            processNextBatch();
        }

        // å¤„ç†ä¸‹ä¸€ä¸ªæ‰¹æ¬¡
        function processNextBatch() {
            if (isProcessingBatch && !batchPaused) {
                if (currentBatchIndex < batchQueue.length) {
                    const item = batchQueue[currentBatchIndex];
                    item.status = 'processing';
                    item.startTime = performance.now();
                    updateBatchProgress();
                    processFile(item.file, (result, error) => {
                        item.status = 'completed';
                        item.result = result;
                        item.error = error;
                        item.endTime = performance.now();
                        item.duration = item.endTime - item.startTime;
                        batchResults.push(item);
                        updateBatchProgress();
                        currentBatchIndex++;
                        processNextBatch();
                    });
                } else {
                    isProcessingBatch = false;
                    updateBatchProgress();
                    updateProcessingTime();
                }
            }
        }

        // æ›´æ–°æ‰¹é‡å¤„ç†è¿›åº¦
        function updateBatchProgress() {
            const progressElement = document.getElementById('batchProgress');
            if (progressElement) {
                const completedCount = batchQueue.filter(item => item.status === 'completed').length;
                progressElement.textContent = `${completedCount} / ${batchQueue.length}`;
            }
        }

        // æ›´æ–°å¤„ç†æ—¶é—´
        function updateProcessingTime() {
            const timeDisplay = document.getElementById('processingTimeDisplay');
            if (timeDisplay) {
                const totalTime = batchResults.reduce((sum, item) => sum + item.duration, 0);
                timeDisplay.textContent = `${(totalTime / 1000).toFixed(2)} ç§’`;
                timeDisplay.className = 'time-display';
            }
        }

        // åˆå§‹åŒ–å›¾ç‰‡ç½‘æ ¼
        function initImageGrid() {
            const imageGrid = document.getElementById('imageGrid');
            if (imageGrid) {
                imageGrid.innerHTML = '';
            }
        }

        // æ›´æ–°æ ‡ç­¾è®¡æ•°å™¨
        function updateTabCounts() {
            const tabCounts = document.getElementById('tabCounts');
            if (tabCounts) {
                tabCounts.textContent = `å¤„ç†æ–‡ä»¶: ${batchQueue.length}`;
            }
        }

        // å¤„ç†æ–‡ä»¶
        function processFile(file, callback) {
            // æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†
            setTimeout(() => {
                const result = `Processed ${file.name}`;
                callback(result, null);
            }, 1000);
        }

        // æš‚åœæ‰¹é‡å¤„ç†
        function pauseBatchProcessing() {
            batchPaused = true;
        }

        // æ¢å¤æ‰¹é‡å¤„ç†
        function resumeBatchProcessing() {
            batchPaused = false;
            processNextBatch();
        }

        // å–æ¶ˆæ‰¹é‡å¤„ç†
        function cancelBatchProcessing() {
            resetBatchProcessing();
            updateBatchProgress();
            updateProcessingTime();
        }            
        document.getElementById('resultsSection').style.display = 'flex';
        
        
        // åˆå§‹åŒ–å›¾ç‰‡ç½‘æ ¼
        function initImageGrid() {
            const imageGrid = document.getElementById('imageGrid');
            imageGrid.innerHTML = '';
            
            batchQueue.forEach((item, index) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.id = `image-item-${index}`;
                
                // è¯»å–å›¾ç‰‡é¢„è§ˆ
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageItem.innerHTML = `
                        <img src="${e.target.result}" alt="${item.file.name}">
                        <div class="image-info">
                            <div style="font-weight: 600; margin-bottom: 4px; color: var(--tibetan-brown);">${item.file.name}</div>
                            <div style="font-size: 0.8rem; color: #64748b; margin-bottom: 8px;">${formatFileSize(item.file.size)}</div>
                        </div>
                        <div class="image-status status-pending" id="status-${index}" style="
                            padding: 4px 8px;
                            border-radius: 12px;
                            font-size: 0.75rem;
                            font-weight: 500;
                            text-align: center;
                            background: var(--tibetan-cream);
                            color: var(--tibetan-brown);
                        ">å¾…è¯†åˆ«</div>
                    `;
                };
                reader.readAsDataURL(item.file);
                
                imageGrid.appendChild(imageItem);
            });
        }
        
        // å¼€å§‹æ‰¹é‡å¤„ç†
        async function startBatchProcessing() {
            if (!isProcessingBatch || batchPaused || currentBatchIndex >= batchQueue.length) {
                return;
            }
            
            const currentItem = batchQueue[currentBatchIndex];
            if (!currentItem || currentItem.status !== 'pending') {
                currentBatchIndex++;
                setTimeout(startBatchProcessing, 100);
                return;
            }
            
            try {
                console.log(`å¤„ç†é˜Ÿåˆ—é¡¹ ${currentBatchIndex + 1}/${batchQueue.length}: ${currentItem.file.name}`);
                updateImageStatus(currentItem.id, 'processing', 'å¤„ç†ä¸­...');
                
                // å¼€å§‹è®¡æ—¶
                const startTime = performance.now();
                batchStartTimes[currentItem.id] = startTime;
                if (processingStartTime === 0) {
                    processingStartTime = startTime;
                }
                
                // ç¡®ä¿ Worker å·²åˆ›å»º
                if (!worker) {
                    await createWorker();
                }
                
                // è¯†åˆ«å›¾åƒ
                const result = await worker.recognize(currentItem.file, getRecognitionOptions(), getOutputFormats());
                
                // ç»“æŸè®¡æ—¶å¹¶è®¡ç®—è€—æ—¶
                const endTime = performance.now();
                const processingTime = endTime - batchStartTimes[currentItem.id];
                
                // å¤„ç†è¯†åˆ«ç»“æœ
                currentItem.status = 'completed';
                currentItem.result = result;
                
                // æ·»åŠ è€—æ—¶ä¿¡æ¯åˆ°ç»“æœä¸­
                currentItem.processingTime = processingTime;
                
                // æ›´æ–°ç•Œé¢å’Œç»“æœ
                updateImageStatus(currentItem.id, 'completed', 'å®Œæˆ');
                updateImageItem(currentItem.id, result.data.text);
                
                // ä¿å­˜åˆ°æ‰¹é‡ç»“æœ
                batchResults.push({
                    id: currentItem.id,
                    filename: currentItem.file.name,
                    text: result.data.text,
                    processingTime: processingTime
                });
                
                // æ›´æ–°è¿›åº¦
                updateBatchProgress();
                updateTabCounts();
                
                // ç”Ÿæˆåˆå¹¶ç»“æœ
                generateCombinedResult();
                
                // ç»§ç»­ä¸‹ä¸€ä¸ª
                currentBatchIndex++;
                
                if (currentBatchIndex >= batchQueue.length) {
                    // è®¡ç®—æ€»å¤„ç†æ—¶é—´
                    processingTotalTime = performance.now() - processingStartTime;
                    
                    // æ›´æ–°æ€»å¤„ç†æ—¶é—´æ˜¾ç¤º
                    const timeDisplay = document.getElementById('processingTimeDisplay');
                    if (timeDisplay && processingTotalTime > 0) {
                        const seconds = (processingTotalTime / 1000).toFixed(2);
                        timeDisplay.textContent = `${seconds} ç§’`;
                        
                        // æ›´æ–°å¤„ç†æ—¶é—´çŠ¶æ€ç±»
                        if (processingTotalTime < 5000) {
                            timeDisplay.className = 'time-display fast';
                        } else if (processingTotalTime < 15000) {
                            timeDisplay.className = 'time-display medium';
                        } else {
                            timeDisplay.className = 'time-display slow';
                        }
                    }
                    
                    // å¤„ç†å®Œæˆ
                    completeBatchProcessing();
                } else {
                    // ç»§ç»­ä¸‹ä¸€ä¸ªå¤„ç†
                    setTimeout(startBatchProcessing, 100);
                }
                
            } catch (error) {
                console.error(`å¤„ç† ${currentItem.file.name} å¤±è´¥:`, error);
                
                // è®°å½•é”™è¯¯
                currentItem.error = error.message;
                
                // å°è¯•é‡è¯•ï¼Œæœ€å¤šé‡è¯•ä¸€æ¬¡
                if (!currentItem.retried) {
                    console.log(`æ­£åœ¨å°è¯•é‡æ–°å¤„ç† ${currentItem.file.name}...`);
                    currentItem.retried = true;
                    
                    // æ˜¾ç¤ºé‡è¯•é€šçŸ¥
                    showNotification('æ­£åœ¨é‡è¯•', `æ­£åœ¨é‡æ–°å¤„ç†æ–‡ä»¶: ${currentItem.file.name}`, 'info', 2000);
                    
                    // é‡ç½® worker
                    if (worker) {
                        await worker.terminate();
                        worker = null;
                    }
                    
                    // ç­‰å¾…çŸ­æš‚åœåé‡è¯•
                    setTimeout(startBatchProcessing, 1000);
                    return;
                }
                
                // å¦‚æœå·²ç»é‡è¯•è¿‡ä»ç„¶å¤±è´¥ï¼Œæ›´æ–°ç•Œé¢
                currentItem.status = 'error';
                updateImageStatus(currentItem.id, 'error', 'è¯†åˆ«å¤±è´¥');
                updateBatchProgress();
                
                // ç»§ç»­ä¸‹ä¸€ä¸ª
                currentBatchIndex++;
                setTimeout(startBatchProcessing, 100);
            }
        }
        
        // å¤„ç†å•ä¸ªæ–‡ä»¶ï¼ˆç”¨äºæ‰¹é‡å¤„ç†ï¼‰
        async function processSingleFile(file, index) {
            console.log(`å¼€å§‹å¤„ç†æ–‡ä»¶ ${index + 1}:`, file.name);
            
            // æ£€æŸ¥Tesseractæ˜¯å¦å¯ç”¨
            if (typeof Tesseract === 'undefined') {
                throw new Error('Tesseract.js æœªåŠ è½½å®Œæˆ');
            }
            
            // åˆ›å»ºæˆ–é‡ç”¨ Worker
            if (!worker || worker.currentLang !== currentLanguage) {
                await createWorker();
            }
            
            // è·å–è¯†åˆ«é€‰é¡¹
            const options = getRecognitionOptions();
            const outputFormats = getOutputFormats();
            
            // æ‰§è¡Œè¯†åˆ«
            const result = await worker.recognize(file, options, outputFormats);
            
            return result;
        }
        async function handleFileSelect(event) {
            console.log('=== æ–‡ä»¶é€‰æ‹©äº‹ä»¶è§¦å‘ ===');
            console.log('Event:', event);
            console.log('Event target:', event.target);
            console.log('Files:', event.target.files);
            
            const files = Array.from(event.target.files);
            if (files.length === 0) {
                console.log('æœªé€‰æ‹©æ–‡ä»¶æˆ–æ–‡ä»¶ä¸ºç©º');
                return;
            }
            
            console.log(`=== é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶ ===`);
            
            // éªŒè¯æ‰€æœ‰æ–‡ä»¶
            const validFiles = [];
            const pdfFiles = [];
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                console.log(`æ–‡ä»¶ ${i + 1}: ${file.name}, ${file.type}, ${file.size} bytes`);
                
                // æ£€æŸ¥æ˜¯å¦ä¸º PDF æ–‡ä»¶
                if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
                    if (file.size > 50 * 1024 * 1024) { // 50MB é™åˆ¶
                        console.error(`PDF æ–‡ä»¶è¿‡å¤§: ${file.name} (${file.size} bytes)`);
                        showNotification('æ–‡ä»¶è¿‡å¤§', `${file.name} è¶…è¿‡50MBï¼Œå·²è·³è¿‡`, 'warning');
                        continue;
                    }
                    pdfFiles.push(file);
                    continue;
                }
                
                // éªŒè¯å›¾ç‰‡æ–‡ä»¶ç±»å‹
                if (!file.type.startsWith('image/')) {
                    console.error(`æ–‡ä»¶ç±»å‹é”™è¯¯: ${file.name} (${file.type})`);
                    showNotification('æ–‡ä»¶ç±»å‹é”™è¯¯', `${file.name} ä¸æ˜¯æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œå·²è·³è¿‡`, 'warning');
                    continue;
                }
                
                // éªŒè¯å›¾ç‰‡æ–‡ä»¶å¤§å° (10MB)
                if (file.size > 10 * 1024 * 1024) {
                    console.error(`å›¾ç‰‡æ–‡ä»¶è¿‡å¤§: ${file.name} (${file.size} bytes)`);
                    showNotification('æ–‡ä»¶è¿‡å¤§', `${file.name} è¶…è¿‡10MBï¼Œå·²è·³è¿‡`, 'warning');
                    continue;
                }
                
                validFiles.push(file);
            }
            
            // å¤„ç† PDF æ–‡ä»¶
            if (pdfFiles.length > 0) {
                try {
                    showNotification('PDF è½¬æ¢', `æ­£åœ¨è½¬æ¢ ${pdfFiles.length} ä¸ª PDF æ–‡ä»¶...`, 'info', 0);
                    const notificationElement = document.querySelector('.notification.info');
                    
                    for (const pdfFile of pdfFiles) {
                        console.log('å¤„ç† PDF æ–‡ä»¶:', pdfFile.name);
                        try {
                            const convertedImages = await convertPdfToImages(pdfFile);
                            validFiles.push(...convertedImages);
                            
                            // å…³é—­ä¹‹å‰çš„é€šçŸ¥
                            if (notificationElement) {
                                closeNotification(notificationElement.querySelector('.notification-close'));
                            }
                            
                            showNotification('PDF è½¬æ¢æˆåŠŸ', 
                                `${pdfFile.name} å·²è½¬æ¢ä¸º ${convertedImages.length} å¼ å›¾ç‰‡`, 'success', 3000);
                                
                            // ç¡®ä¿éšè—è¿›åº¦æ¡
                            hideProgress();
                        } catch (pdfError) {
                            console.error('PDF è½¬æ¢å¤±è´¥:', pdfError);
                            
                            // å…³é—­ä¹‹å‰çš„é€šçŸ¥
                            if (notificationElement) {
                                closeNotification(notificationElement.querySelector('.notification-close'));
                            }
                            
                            showNotification('PDF è½¬æ¢å¤±è´¥', 
                                `${pdfFile.name}: ${pdfError.message}`, 'error', 5000);
                            
                            // ç¡®ä¿éšè—è¿›åº¦æ¡
                            hideProgress();
                            
                            // å¦‚æœæ²¡æœ‰å…¶ä»–æœ‰æ•ˆæ–‡ä»¶ä¸”è¿™æ˜¯æœ€åä¸€ä¸ªPDFæ–‡ä»¶ï¼Œç›´æ¥è¿”å›
                            if (validFiles.length === 0 && pdfFiles.indexOf(pdfFile) === pdfFiles.length - 1) {
                                return;
                            }
                        }
                    }
                    
                    // ç¡®ä¿å…³é—­ä¹‹å‰çš„é€šçŸ¥
                    const allNotifications = document.querySelectorAll('.notification');
                    allNotifications.forEach(notification => {
                        if (notification.textContent.includes('PDF è½¬æ¢') || notification.textContent.includes('æ­£åœ¨è½¬æ¢')) {
                            closeNotification(notification.querySelector('.notification-close'));
                        }
                    });
                    
                } catch (error) {
                    console.error('PDF å¤„ç†å¤±è´¥:', error);
                    showNotification('PDF å¤„ç†å¤±è´¥', error.message, 'error');
                    hideProgress();
                    
                    if (validFiles.length === 0) {
                        return; // å¦‚æœæ²¡æœ‰å…¶ä»–æœ‰æ•ˆæ–‡ä»¶ï¼Œç›´æ¥è¿”å›
                    }
                }
            }
            
            if (validFiles.length === 0) {
                showNotification('æ²¡æœ‰æœ‰æ•ˆæ–‡ä»¶', 'è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æˆ– PDF æ–‡ä»¶', 'error');
                hideProgress();
                return;
            }
            
            console.log(`æœ‰æ•ˆæ–‡ä»¶æ•°é‡: ${validFiles.length}`);
            
            // ç¡®ä¿éšè—è¿›åº¦æ¡
            hideProgress();
            
            // ç»Ÿä¸€ä½¿ç”¨æ‰¹é‡å¤„ç†æ¨¡å¼ï¼ˆæ”¯æŒå•å¼ æˆ–å¤šå¼ ï¼‰
            handleFiles(validFiles);
        }

        // ç»Ÿä¸€å¤„ç†æ–‡ä»¶ï¼ˆæ”¯æŒå•å¼ æˆ–å¤šå¼ ï¼‰
        function handleFiles(files) {
            console.log(`æ–‡ä»¶å¤„ç†æ¨¡å¼: ${files.length} ä¸ªæ–‡ä»¶`);
            
            // éšè—æ¬¢è¿æ¶ˆæ¯ï¼Œæ˜¾ç¤ºç»“æœåŒºåŸŸ
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }
            document.getElementById('resultsSection').style.display = 'flex';
            
            // æ˜¾ç¤ºæ ‡ç­¾é¡µ
            document.getElementById('resultTabs').style.display = 'flex';
            
            // å¦‚æœæ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œæ˜¾ç¤ºæ‰¹é‡ä¿¡æ¯é¢æ¿
            if (files.length > 1) {
                document.getElementById('batchInfo').classList.add('show');
            } else {
                document.getElementById('batchInfo').classList.remove('show');
            }
            
            // åˆå§‹åŒ–æ‰¹é‡å¤„ç†
            initBatchProcessing(files);
            
            // æ˜¾ç¤ºæ‰¹é‡ç»“æœé¢æ¿
            showResultPanel('batch');
            
            // å¼€å§‹æ‰¹é‡å¤„ç†
            startBatchProcessing();
        }

        // åˆ›å»º Worker
        async function createWorker() {
            console.log(`å¼€å§‹åˆ›å»ºWorkerï¼Œè¯­è¨€: ${currentLanguage}`);
            showProgress('æ­£åœ¨åˆå§‹åŒ–è¯†åˆ«å¼•æ“...', 0);
            
            if (worker) {
                console.log('ç»ˆæ­¢ç°æœ‰Worker');
                await worker.terminate();
            }

            // è®¾ç½®æ›´é•¿çš„è¶…æ—¶æ—¶é—´ï¼Œå¹¶æ·»åŠ é‡è¯•æœºåˆ¶
            const timeout = new Promise((_, reject) => {
                setTimeout(() => {
                    reject(new Error(`è¯­è¨€åŒ… ${currentLanguage} åŠ è½½è¶…æ—¶ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–é€‰æ‹©å…¶ä»–è¯­è¨€ï¼ˆæ¨èï¼šè‹±è¯­ engï¼‰`));
                }, 120000); // å¢åŠ åˆ°2åˆ†é’Ÿ
            });

            let retryCount = 0;
            const maxRetries = 2;
            
            const createWorkerWithRetry = async () => {
                try {
                    console.log(`å°è¯•åˆ›å»ºWorker (${retryCount + 1}/${maxRetries + 1})`);
                    
                    const workerPromise = Tesseract.createWorker(currentLanguage, 1, {
                        workerPath: '/dist/worker.min.js',
                        gzip: true,  // å¯ç”¨gzipå‹ç¼©ä»¥å‡å°‘ä¸‹è½½å¤§å°
                        cacheMethod: 'write',  // å¯ç”¨ç¼“å­˜ä»¥æé«˜é‡å¤ä½¿ç”¨é€Ÿåº¦
                        // langPath ç•™ç©ºä½¿ç”¨é»˜è®¤CDN: https://cdn.jsdelivr.net/npm/@tesseract.js-data/
                        logger: function(m) {
                            console.log('Workeræ—¥å¿—:', m);
                            if (m.status && m.progress !== undefined) {
                                const percentage = Math.round(m.progress * 100);
                                
                                // æ›´è¯¦ç»†çš„çŠ¶æ€ä¿¡æ¯
                                let statusText = m.status;
                                let title = 'æ­£åœ¨å¤„ç†...';
                                
                                if (m.status.includes('downloading')) {
                                    statusText = `æ­£åœ¨ä¸‹è½½ ${currentLanguage} è¯­è¨€åŒ…...`;
                                    title = 'ä¸‹è½½è¯­è¨€åŒ…';
                                } else if (m.status.includes('loading')) {
                                    statusText = `æ­£åœ¨åŠ è½½ ${currentLanguage} è¯­è¨€åŒ…...`;
                                    title = 'åŠ è½½è¯­è¨€åŒ…';
                                } else if (m.status.includes('initializing')) {
                                    statusText = 'æ­£åœ¨åˆå§‹åŒ–è¯†åˆ«å¼•æ“...';
                                    title = 'åˆå§‹åŒ–å¼•æ“';
                                } else if (m.status.includes('recognizing')) {
                                    statusText = 'æ­£åœ¨è¯†åˆ«æ–‡å­—å†…å®¹...';
                                    title = 'è¯†åˆ«æ–‡å­—';
                                }
                                
                                showProgress(statusText, percentage, title);
                            }
                        }
                    });

                    return await Promise.race([workerPromise, timeout]);
                    
                } catch (error) {
                    console.error(`Workeråˆ›å»ºå¤±è´¥ (å°è¯• ${retryCount + 1}):`, error);
                    
                    if (retryCount < maxRetries) {
                        retryCount++;
                        showProgress(`åˆ›å»ºå¤±è´¥ï¼Œæ­£åœ¨é‡è¯• (${retryCount}/${maxRetries})...`, 0);
                        await new Promise(resolve => setTimeout(resolve, 2000)); // ç­‰å¾…2ç§’åé‡è¯•
                        return createWorkerWithRetry();
                    } else {
                        // å¦‚æœä¸æ˜¯è‹±è¯­ï¼Œå»ºè®®åˆ‡æ¢åˆ°è‹±è¯­
                        if (currentLanguage !== 'eng') {
                            throw new Error(`${currentLanguage} è¯­è¨€åŒ…åŠ è½½å¤±è´¥ã€‚å»ºè®®åˆ‡æ¢åˆ°è‹±è¯­ (English) è¿›è¡Œæµ‹è¯•ï¼Œè‹±è¯­åŒ…è¾ƒå°ä¸”ç¨³å®šã€‚`);
                        } else {
                            throw error;
                        }
                    }
                }
            };

            try {
                worker = await createWorkerWithRetry();
                worker.currentLang = currentLanguage;
                console.log(`Workeråˆ›å»ºæˆåŠŸï¼Œè¯­è¨€: ${currentLanguage}`);
                showProgress('è¯†åˆ«å¼•æ“å‡†å¤‡å°±ç»ª', 100);
                
            } catch (error) {
                console.error('Workeråˆ›å»ºæœ€ç»ˆå¤±è´¥:', error);
                throw error;
            }
        }

        // è·å–è¯†åˆ«é€‰é¡¹
        function getRecognitionOptions() {
            return {
                rotateAuto: false  // é»˜è®¤ç¦ç”¨è‡ªåŠ¨æ—‹è½¬ä»¥æé«˜é€Ÿåº¦
            };
        }
        
        // è·å–è¾“å‡ºæ ¼å¼
        function getOutputFormats() {
            return {
                text: true,  // åªè¾“å‡ºæ–‡æœ¬æ ¼å¼
                blocks: false,
                hocr: false,
                imageGrey: false,
                imageBinary: false
            };
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(data) {
            console.log('æ˜¾ç¤ºè¯†åˆ«ç»“æœ:', data);
            
            // ç¡®ä¿ç»“æœåŒºåŸŸå¯è§
            const resultsSection = document.getElementById('resultsSection');
            if (resultsSection) {
                resultsSection.style.display = 'flex';
            }
            
            // ç¡®ä¿å•å¼ ç»“æœé¢æ¿æ¿€æ´»
            showResultPanel('single');
            
            // æ˜¾ç¤ºæ–‡æœ¬ç»“æœ
            const textResult = document.getElementById('textResult');
            if (textResult) {
                textResult.textContent = data.text || 'æœªè¯†åˆ«åˆ°æ–‡å­—';
                console.log('æ–‡æœ¬ç»“æœå·²æ›´æ–°');
            }

            // æ˜¾ç¤ºå¤„ç†åçš„å›¾åƒ
            const processedImages = document.getElementById('processedImages');
            if (processedImages) {
                processedImages.innerHTML = '';

                if (data.imageGrey) {
                    const greyDiv = document.createElement('div');
                    greyDiv.innerHTML = `
                        <h4 style="margin: 15px 0 10px 0; color: #475569; font-size: 0.95rem;">ç°åº¦å›¾</h4>
                        <img src="${data.imageGrey}" style="max-width: 100%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    `;
                    processedImages.appendChild(greyDiv);
                }

                if (data.imageBinary) {
                    const binaryDiv = document.createElement('div');
                    binaryDiv.innerHTML = `
                        <h4 style="margin: 15px 0 10px 0; color: #475569; font-size: 0.95rem;">äºŒå€¼åŒ–å›¾</h4>
                        <img src="${data.imageBinary}" style="max-width: 100%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    `;
                    processedImages.appendChild(binaryDiv);
                }
            }

            // æ˜¾ç¤ºå…¶ä»–æ ¼å¼è¾“å‡º
            const additionalOutput = document.getElementById('additionalOutput');
            if (additionalOutput) {
                additionalOutput.innerHTML = '';

                if (data.blocks) {
                    const blocksDiv = document.createElement('div');
                    blocksDiv.style.cssText = 'background: white; padding: 24px; border-radius: 16px; border: 1px solid #e2e8f0; box-shadow: 0 4px 12px rgba(0,0,0,0.04);';
                    const blocksContent = document.createElement('pre');
                    blocksContent.className = 'custom-scrollbar';
                    blocksContent.style.cssText = 'background: #f8fafc; padding: 16px; border-radius: 8px; overflow: auto; max-height: 300px; font-size: 0.85rem; line-height: 1.4; border: 1px solid #e2e8f0;';
                    blocksContent.textContent = JSON.stringify(data.blocks, null, 2);
                    blocksDiv.innerHTML = `<h4 style="margin-bottom: 16px; color: #1e293b; font-size: 1.1rem; font-weight: 600;">ğŸ“Š å—çº§æ•°æ®</h4>`;
                    blocksDiv.appendChild(blocksContent);
                    additionalOutput.appendChild(blocksDiv);
                }

                if (data.hocr) {
                    const hocrDiv = document.createElement('div');
                    hocrDiv.style.cssText = 'background: white; padding: 24px; border-radius: 16px; border: 1px solid #e2e8f0; box-shadow: 0 4px 12px rgba(0,0,0,0.04); margin-top: 16px;';
                    const hocrContent = document.createElement('pre');
                    hocrContent.className = 'custom-scrollbar';
                    hocrContent.style.cssText = 'background: #f8fafc; padding: 16px; border-radius: 8px; overflow: auto; max-height: 300px; font-size: 0.85rem; line-height: 1.4; border: 1px solid #e2e8f0;';
                    hocrContent.textContent = data.hocr;
                    hocrDiv.innerHTML = `<h4 style="margin-bottom: 16px; color: #1e293b; font-size: 1.1rem; font-weight: 600;">ğŸ“‹ hOCR æ ¼å¼</h4>`;
                    hocrDiv.appendChild(hocrContent);
                    additionalOutput.appendChild(hocrDiv);
                }
            }
            
            console.log('è¯†åˆ«ç»“æœæ˜¾ç¤ºå®Œæˆ');
        }

        // æ˜¾ç¤ºè¿›åº¦
        function showProgress(message, percentage = null, title = 'æ­£åœ¨å¤„ç†...') {
            console.log(`æ˜¾ç¤ºè¿›åº¦: ${title} - ${message} - ${percentage}%`);
            
            const progressSection = document.getElementById('progressSection');
            const progressTitle = document.getElementById('progressTitle');
            const progressSubtitle = document.getElementById('progressSubtitle');
            const progressStatus = document.getElementById('progressStatus');
            const progressBarFill = document.getElementById('progressFill'); // ä¿®æ­£ID
            const progressPercentage = document.getElementById('progressPercentage');
            const progressActions = document.getElementById('progressActions');
            const progressIcon = document.getElementById('progressIcon');
            const switchBtn = document.getElementById('switchBtn');

            if (!progressSection) {
                console.error('æ‰¾ä¸åˆ°è¿›åº¦æ¡å…ƒç´  progressSection');
                return;
            }

            progressSection.style.display = 'flex';
            if (progressTitle) progressTitle.textContent = title;
            if (progressSubtitle) progressSubtitle.textContent = 'è¯·ç¨å€™ï¼Œæˆ‘ä»¬æ­£åœ¨ä¸ºæ‚¨å¤„ç†...';
            if (progressStatus) progressStatus.textContent = message;
            
            // æ›´æ–°è¿›åº¦æ¡
            if (percentage !== null && progressBarFill && progressPercentage) {
                progressBarFill.style.width = percentage + '%';
                progressPercentage.textContent = percentage + '%';
            } else if (progressBarFill && progressPercentage) {
                progressBarFill.style.width = '0%';
                progressPercentage.textContent = '0%';
            }
            
            // æ ¹æ®ä¸åŒé˜¶æ®µæ˜¾ç¤ºä¸åŒå›¾æ ‡
            if (progressIcon) {
                if (message.includes('è¯­è¨€åŒ…') || message.includes('ä¸‹è½½')) {
                    progressIcon.textContent = 'ğŸ“¦'; // ä¸‹è½½å›¾æ ‡
                    if (progressTitle) progressTitle.textContent = 'ä¸‹è½½è¯­è¨€åŒ…';
                    // å¦‚æœè¿›åº¦å¡ä½ï¼Œæ˜¾ç¤ºå–æ¶ˆå’Œåˆ‡æ¢æŒ‰é’®
                    if (percentage !== null && percentage < 10) {
                        clearTimeout(window.progressUpdateTimer);
                        window.progressUpdateTimer = setTimeout(() => {
                            if (progressBarFill && (progressBarFill.style.width === '0%' || parseInt(progressBarFill.style.width) < 10)) {
                                if (progressActions) progressActions.style.display = 'flex';
                                if (currentLanguage !== 'eng' && switchBtn) {
                                    switchBtn.style.display = 'block';
                                }
                            }
                        }, 15000); // 15ç§’åæ˜¾ç¤ºæ“ä½œæŒ‰é’®
                    }
                } else if (message.includes('åˆå§‹åŒ–') || message.includes('åŠ è½½')) {
                    progressIcon.textContent = 'âš™ï¸'; // è®¾ç½®å›¾æ ‡
                    if (progressTitle) progressTitle.textContent = 'åˆå§‹åŒ–å¼•æ“';
                } else if (message.includes('è¯†åˆ«')) {
                    progressIcon.textContent = 'ğŸ”'; // æœç´¢å›¾æ ‡
                    if (progressTitle) progressTitle.textContent = 'è¯†åˆ«æ–‡å­—';
                    if (progressActions) progressActions.style.display = 'none'; // è¯†åˆ«é˜¶æ®µéšè—æŒ‰é’®
                } else if (message.includes('PDF') || message.includes('è½¬æ¢')) {
                    progressIcon.textContent = 'ğŸ“„'; // PDFå›¾æ ‡
                    if (progressTitle) progressTitle.textContent = 'PDF è½¬æ¢';
                } else {
                    progressIcon.textContent = 'ğŸ”„'; // é»˜è®¤å›¾æ ‡
                }
            }
        }
        
        // éšè—è¿›åº¦
        function hideProgress() {
            console.log('éšè—è¿›åº¦æ¡');
            
            const progressSection = document.getElementById('progressSection');
            if (!progressSection) {
                console.error('æ‰¾ä¸åˆ°è¿›åº¦æ¡å…ƒç´  progressSection');
                return;
            }
            
            // è®¾ç½®è¿›åº¦æ¡ä¸º100%å¹¶æ˜¾ç¤ºå®ŒæˆçŠ¶æ€ï¼Œç„¶åå»¶è¿Ÿéšè—
            const progressBarFill = document.getElementById('progressFill'); // ä¿®æ­£ID
            const progressPercentage = document.getElementById('progressPercentage');
            const progressTitle = document.getElementById('progressTitle');
            const progressStatus = document.getElementById('progressStatus');
            const progressActions = document.getElementById('progressActions');
            const switchBtn = document.getElementById('switchBtn');
            
            if (progressBarFill) progressBarFill.style.width = '100%';
            if (progressPercentage) progressPercentage.textContent = '100%';
            if (progressTitle) progressTitle.textContent = 'å¤„ç†å®Œæˆ';
            if (progressStatus) progressStatus.textContent = 'æ‰€æœ‰ä»»åŠ¡å·²æˆåŠŸå®Œæˆ';
            
            // ç¡®ä¿è§£é™¤ä»»ä½•å¯èƒ½çš„è¿›åº¦æ›´æ–°è®¡æ—¶å™¨
            clearTimeout(window.progressUpdateTimer);
            
            // å»¶è¿Ÿéšè—è¿›åº¦æ¡†ï¼Œè®©ç”¨æˆ·çœ‹åˆ°å®ŒæˆçŠ¶æ€
            setTimeout(() => {
                progressSection.style.display = 'none';
                if (progressActions) progressActions.style.display = 'none';
                if (switchBtn) switchBtn.style.display = 'none';
                
                // ç¡®ä¿é‡ç½®è¿›åº¦æ¡çŠ¶æ€ï¼Œä¸ºä¸‹æ¬¡ä½¿ç”¨åšå‡†å¤‡
                if (progressBarFill) progressBarFill.style.width = '0%';
                if (progressPercentage) progressPercentage.textContent = '0%';
                if (progressStatus) progressStatus.textContent = '';
                
                console.log('è¿›åº¦æ¡å·²éšè—');
            }, 1000);
        }
        
        // å¿«é€Ÿåˆ‡æ¢åˆ°è‹±è¯­
        function switchToEnglish() {
            console.log('ç”¨æˆ·è¯·æ±‚åˆ‡æ¢åˆ°è‹±è¯­');
            
            // å–æ¶ˆå½“å‰åŠ è½½
            if (worker) {
                worker.terminate();
                worker = null;
            }
            
            // åˆ‡æ¢è¯­è¨€
            currentLanguage = 'eng';
            document.getElementById('languageSelect').value = 'eng';
            
            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            showNotification('è¯­è¨€å·²åˆ‡æ¢', 'å·²åˆ‡æ¢åˆ°è‹±è¯­ï¼Œè¯·é‡æ–°é€‰æ‹©å›¾ç‰‡è¿›è¡Œè¯†åˆ«', 'success');
            hideProgress();
        }
        
        // å–æ¶ˆåŠ è½½
        function cancelLoading() {
            console.log('ç”¨æˆ·å–æ¶ˆåŠ è½½');
            if (worker) {
                worker.terminate();
                worker = null;
            }
            hideProgress();
            showNotification('åŠ è½½å·²å–æ¶ˆ', 'æ‚¨å¯ä»¥é‡æ–°é€‰æ‹©å›¾ç‰‡æˆ–åˆ‡æ¢è¯­è¨€', 'info');
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccess(message) {
            showMessage(message, 'success');
        }
        
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showError(message) {
            console.error('é”™è¯¯:', message);
            showMessage(message, 'error');
        }

        // è·å–è¯­è¨€åç§°
        function getLanguageName(langCode) {
            const langMap = {
                'bod': 'è—æ–‡',
                'eng': 'è‹±è¯­',
                'chi_sim': 'ç®€ä½“ä¸­æ–‡',
                'chi_tra': 'ç¹ä½“ä¸­æ–‡',
                'jpn': 'æ—¥è¯­',
                'kor': 'éŸ©è¯­',
                'ara': 'é˜¿æ‹‰ä¼¯è¯­',
                'hin': 'å°åœ°è¯­',
                'rus': 'ä¿„è¯­',
                'fra': 'æ³•è¯­',
                'deu': 'å¾·è¯­',
                'spa': 'è¥¿ç­ç‰™è¯­',
                'tha': 'æ³°è¯­',
                'vie': 'è¶Šå—è¯­',
                'eng+chi_sim': 'è‹±è¯­+ç®€ä½“ä¸­æ–‡',
                'eng+bod': 'è‹±è¯­+è—æ–‡',
                'chi_sim+bod': 'ç®€ä½“ä¸­æ–‡+è—æ–‡'
            };
            return langMap[langCode] || langCode;
        }
        
        // æ˜¾ç¤ºé¡¶éƒ¨é€šçŸ¥
        function showNotification(title, message = '', type = 'info', duration = 4000) {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            // è®¾ç½®å›¾æ ‡
            let icon = 'â„¹ï¸'; // é»˜è®¤ä¿¡æ¯å›¾æ ‡
            switch (type) {
                case 'success':
                    icon = 'âœ…'; // æˆåŠŸ
                    break;
                case 'error':
                    icon = 'âŒ'; // é”™è¯¯
                    break;
                case 'warning':
                    icon = 'âš ï¸'; // è­¦å‘Š
                    break;
                case 'info':
                default:
                    icon = 'â„¹ï¸'; // ä¿¡æ¯
                    break;
            }
            
            notification.innerHTML = `
                <div class="notification-icon">${icon}</div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    ${message ? `<div class="notification-message">${message}</div>` : ''}
                </div>
                <button class="notification-close" onclick="closeNotification(this)">Ã—</button>
            `;
            
            // æ·»åŠ åˆ°å®¹å™¨
            container.appendChild(notification);
            
            // è‡ªåŠ¨å…³é—­
            if (duration > 0) {
                setTimeout(() => {
                    closeNotification(notification.querySelector('.notification-close'));
                }, duration);
            }
            
            return notification;
        }
        
        // å…³é—­é€šçŸ¥
        function closeNotification(closeBtn) {
            // å¦‚æœä¼ å…¥çš„æ˜¯nullæˆ–undefinedï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ
            if (!closeBtn) {
                console.warn('å°è¯•å…³é—­é€šçŸ¥æ—¶æä¾›äº†æ— æ•ˆçš„æŒ‰é’®');
                return;
            }
            
            // å…¼å®¹ç›´æ¥ä¼ å…¥é€šçŸ¥å…ƒç´ çš„æƒ…å†µ
            let notification;
            if (closeBtn.classList && closeBtn.classList.contains('notification')) {
                notification = closeBtn;
                closeBtn = notification.querySelector('.notification-close');
                if (!closeBtn) {
                    console.warn('é€šçŸ¥å…ƒç´ ä¸­æ‰¾ä¸åˆ°å…³é—­æŒ‰é’®');
                    // ä»ç„¶å°è¯•ç§»é™¤é€šçŸ¥å…ƒç´ 
                    if (notification.parentNode) {
                        notification.classList.add('slide-out');
                        setTimeout(() => {
                            try {
                                notification.parentNode.removeChild(notification);
                            } catch (e) {
                                console.error('ç§»é™¤é€šçŸ¥å…ƒç´ å¤±è´¥:', e);
                            }
                        }, 300);
                    }
                    return;
                }
            } else {
                notification = closeBtn.closest('.notification');
                if (!notification) {
                    console.warn('æ‰¾ä¸åˆ°ä¸å…³é—­æŒ‰é’®å…³è”çš„é€šçŸ¥å…ƒç´ ');
                    return;
                }
            }
            
            // æ·»åŠ åŠ¨ç”»å¹¶ç§»é™¤å…ƒç´ 
            try {
                notification.classList.add('slide-out');
                setTimeout(() => {
                    if (notification.parentNode) {
                        try {
                            notification.parentNode.removeChild(notification);
                        } catch (e) {
                            console.error('ç§»é™¤é€šçŸ¥å…ƒç´ å¤±è´¥:', e);
                        }
                    }
                }, 300);
            } catch (error) {
                console.error('å…³é—­é€šçŸ¥å¤±è´¥:', error);
                // å°è¯•ç›´æ¥ç§»é™¤
                if (notification && notification.parentNode) {
                    try {
                        notification.parentNode.removeChild(notification);
                    } catch (e) {
                        console.error('ç›´æ¥ç§»é™¤é€šçŸ¥å…ƒç´ å¤±è´¥:', e);
                    }
                }
            }
        }
        
        // ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™åŸæœ‰çš„showMessageå‡½æ•°ä½†æ”¹ä¸ºè°ƒç”¨é¡¶éƒ¨é€šçŸ¥
        function showMessage(message, type = 'info') {
            let title = 'æç¤º';
            switch (type) {
                case 'success':
                    title = 'æˆåŠŸ';
                    break;
                case 'error':
                    title = 'é”™è¯¯';
                    break;
                case 'info':
                default:
                    title = 'ä¿¡æ¯';
                    break;
            }
            showNotification(title, message, type);
        }

        // ç»ˆæ­¢ Worker
        async function terminateWorker() {
            if (worker) {
                await worker.terminate();
                worker = null;
            }
        }



        // é¢„åŠ è½½è—æ–‡æ¨¡å‹
        async function preloadTibetan() {
            if (isPreloading) return;
            isPreloading = true;
            
            try {
                console.log('å¼€å§‹é¢„åŠ è½½è—æ–‡æ¨¡å‹...');
                
                // æ£€æŸ¥Tesseractæ˜¯å¦å¯ç”¨
                if (typeof Tesseract === 'undefined') {
                    console.log('Tesseractå°šæœªåŠ è½½ï¼Œè·³è¿‡é¢„åŠ è½½');
                    return;
                }
                
                const tibetanWorker = await Tesseract.createWorker('bod', 1, {
                    workerPath: '/dist/worker.min.js',
                    gzip: true,
                    cacheMethod: 'write',
                    // ä½¿ç”¨é»˜è®¤çš„ CDN langPath
                    logger: (m) => console.log('é¢„åŠ è½½è—æ–‡:', m)
                });
                
                // ç›´æ¥ä½¿ç”¨é¢„åŠ è½½çš„worker
                worker = tibetanWorker;
                worker.currentLang = 'bod';
                console.log('è—æ–‡æ¨¡å‹é¢„åŠ è½½å®Œæˆå¹¶å·²æ¿€æ´»');
                showNotification('è—æ–‡è¯†åˆ«å¼•æ“å·²å‡†å¤‡å°±ç»ª', 'å¯ä»¥å¼€å§‹ä¸Šä¼ å›¾ç‰‡è¿›è¡Œè¯†åˆ«', 'success');
                
            } catch (error) {
                console.log('è—æ–‡æ¨¡å‹é¢„åŠ è½½å¤±è´¥ï¼Œå°†åœ¨éœ€è¦æ—¶åŠ è½½:', error.message);
            } finally {
                isPreloading = false;
            }
        }

        // å¤åˆ¶ç»“æœåˆ°å‰ªè´´æ¿
        async function copyResult() {
            const resultElement = document.getElementById('combinedResult');
            const text = resultElement.textContent || resultElement.innerText;
            
            if (!text || text === 'åˆå¹¶ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...') {
                showNotification('æ— æ³•å¤åˆ¶', 'æ²¡æœ‰å¯å¤åˆ¶çš„è¯†åˆ«ç»“æœ', 'warning');
                return;
            }
            
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    // ä½¿ç”¨ç°ä»£ Clipboard API
                    await navigator.clipboard.writeText(text);
                } else {
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šä¼ ç»Ÿæ–¹æ³•
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    textArea.remove();
                }
                
                showNotification('å¤åˆ¶æˆåŠŸ', 'è¯†åˆ«ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                console.log('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                
            } catch (error) {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                showNotification('å¤åˆ¶å¤±è´¥', 'æ— æ³•å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨é€‰ä¸­å¤åˆ¶', 'error');
            }
        }
        
        // ä¿å­˜ç»“æœä¸ºTXTæ–‡ä»¶
        function saveResult() {
            const resultElement = document.getElementById('combinedResult');
            const text = resultElement.textContent || resultElement.innerText;
            
            if (!text || text === 'åˆå¹¶ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...') {
                showNotification('æ— æ³•ä¿å­˜', 'æ²¡æœ‰å¯ä¿å­˜çš„è¯†åˆ«ç»“æœ', 'warning');
                return;
            }
            
            try {
                // åˆ›å»ºæ–‡ä»¶åï¼ˆåŒ…å«æ—¶é—´æˆ³ï¼‰
                const now = new Date();
                const timestamp = now.toISOString().slice(0, 19).replace(/[:-]/g, '').replace('T', '_');
                const filename = `OCR_è¯†åˆ«ç»“æœ_${timestamp}.txt`;
                
                // åˆ›å»º Blob å¯¹è±¡
                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // æ¸…ç† URL å¯¹è±¡
                window.URL.revokeObjectURL(url);
                
                showNotification('ä¿å­˜æˆåŠŸ', `è¯†åˆ«ç»“æœå·²ä¿å­˜ä¸º ${filename}`, 'success');
                console.log('ç»“æœå·²ä¿å­˜ä¸ºæ–‡ä»¶:', filename);
                
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                showNotification('ä¿å­˜å¤±è´¥', 'æ— æ³•ä¿å­˜æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®', 'error');
            }
        }
        
        // PDF è½¬å›¾ç‰‡åŠŸèƒ½
        async function convertPdfToImages(file) {
            console.log('å¼€å§‹è½¬æ¢ PDF æ–‡ä»¶:', file.name);
            
            // æ£€æŸ¥PDF.jsæ˜¯å¦å·²åŠ è½½
            if (typeof pdfjsLib === 'undefined' || !pdfjsLib.getDocument) {
                throw new Error('PDF.js åº“æœªæ­£ç¡®åŠ è½½ï¼Œæ— æ³•å¤„ç† PDF æ–‡ä»¶ã€‚è¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚');
            }
            
            try {
                // è®¾ç½®PDF.js workerè·¯å¾„
                if (!pdfjsLib.GlobalWorkerOptions.workerSrc) {
                    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                }
                
                // è¯»å– PDF æ–‡ä»¶
                showProgress('æ­£åœ¨è¯»å– PDF æ–‡ä»¶...', 5, 'PDF è½¬æ¢');
                const arrayBuffer = await file.arrayBuffer();
                
                // åŠ è½½ PDF æ–‡æ¡£
                showProgress('æ­£åœ¨åŠ è½½ PDF æ–‡æ¡£...', 10, 'PDF è½¬æ¢');
                const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
                
                // æ·»åŠ åŠ è½½è¿›åº¦ç›‘å¬
                loadingTask.onProgress = function(progressData) {
                    if (progressData.total > 0) {
                        const percentage = Math.round((progressData.loaded / progressData.total) * 30) + 10;
                        showProgress(`æ­£åœ¨åŠ è½½ PDF æ–‡æ¡£... (${Math.round(progressData.loaded/1024)}KB/${Math.round(progressData.total/1024)}KB)`, 
                                   percentage, 'PDF è½¬æ¢');
                    }
                };
                
                const pdf = await loadingTask.promise;
                
                const images = [];
                const totalPages = pdf.numPages;
                
                console.log(`PDF å…±æœ‰ ${totalPages} é¡µ`);
                
                if (totalPages === 0) {
                    throw new Error('PDF æ–‡ä»¶æ²¡æœ‰é¡µé¢å†…å®¹');
                }
                
                // è½¬æ¢æ¯ä¸€é¡µä¸ºå›¾ç‰‡
                for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                    try {
                        showProgress(`æ­£åœ¨è½¬æ¢ PDF ç¬¬ ${pageNum}/${totalPages} é¡µ...`, 
                                   30 + (pageNum - 1) / totalPages * 60, // PDFè½¬æ¢å 30%-90%è¿›åº¦
                                   'PDF è½¬æ¢');
                        
                        const page = await pdf.getPage(pageNum);
                        
                        // è®¾ç½®é€‚ä¸­çš„åˆ†è¾¨ç‡ï¼ˆé¿å…å†…å­˜é—®é¢˜ï¼‰
                        const scale = 1.5; // é™ä½åˆ†è¾¨ç‡ä»¥å‡å°‘å†…å­˜ä½¿ç”¨
                        const viewport = page.getViewport({ scale });
                        
                        // æ£€æŸ¥é¡µé¢å°ºå¯¸æ˜¯å¦åˆç†
                        if (viewport.width > 5000 || viewport.height > 5000) {
                            console.warn(`PDF ç¬¬ ${pageNum} é¡µå°ºå¯¸è¿‡å¤§ï¼Œå¯èƒ½å½±å“æ€§èƒ½`);
                        }
                        
                        // åˆ›å»º canvas
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        // æ¸²æŸ“ PDF é¡µé¢åˆ° canvas
                        const renderContext = {
                            canvasContext: context,
                            viewport: viewport
                        };
                        
                        // æ·»åŠ æ¸²æŸ“è¿›åº¦ç›‘å¬
                        const renderTask = page.render(renderContext);
                        await renderTask.promise;
                        
                        // å°† canvas è½¬æ¢ä¸º Blob
                        showProgress(`æ­£åœ¨å¤„ç†ç¬¬ ${pageNum}/${totalPages} é¡µå›¾åƒ...`, 
                                   90 + (pageNum - 1) / totalPages * 5, // å›¾åƒå¤„ç†å 90%-95%è¿›åº¦
                                   'PDF è½¬æ¢');
                        
                        const blob = await new Promise((resolve, reject) => {
                            canvas.toBlob((blob) => {
                                if (blob) {
                                    resolve(blob);
                                } else {
                                    reject(new Error('å›¾åƒè½¬æ¢å¤±è´¥'));
                                }
                            }, 'image/png', 0.8); // é™ä½è´¨é‡ä»¥å‡å°‘å†…å­˜ä½¿ç”¨
                        });
                        
                        // åˆ›å»ºè™šæ‹Ÿæ–‡ä»¶å¯¹è±¡
                        const imageFile = new File([blob], `${file.name}_ç¬¬${pageNum}é¡µ.png`, {
                            type: 'image/png',
                            lastModified: Date.now()
                        });
                        
                        images.push(imageFile);
                        
                        console.log(`PDF ç¬¬ ${pageNum} é¡µè½¬æ¢å®Œæˆ`);
                    } catch (pageError) {
                        console.error(`PDF ç¬¬ ${pageNum} é¡µè½¬æ¢å¤±è´¥:`, pageError);
                        // ç»§ç»­å¤„ç†å…¶ä»–é¡µé¢è€Œä¸æ˜¯ä¸­æ–­æ•´ä¸ªè¿‡ç¨‹
                        showNotification('PDF é¡µé¢è½¬æ¢å¤±è´¥', `ç¬¬ ${pageNum} é¡µè½¬æ¢å¤±è´¥ï¼Œè·³è¿‡è¯¥é¡µç»§ç»­å¤„ç†`, 'warning');
                    }
                }
                
                if (images.length === 0) {
                    throw new Error('æœªèƒ½ä»PDFä¸­æå–ä»»ä½•é¡µé¢');
                }
                
                showProgress('PDF è½¬æ¢å®Œæˆ', 100, 'PDF è½¬æ¢');
                console.log(`PDF è½¬æ¢å®Œæˆï¼Œå…±ç”Ÿæˆ ${images.length} å¼ å›¾ç‰‡`);
                
                // æ·»åŠ å»¶è¿Ÿï¼Œç¡®ä¿è¿›åº¦æ˜¾ç¤ºå®Œæˆ
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ‰‹åŠ¨å…³é—­è¿›åº¦æ¡
                hideProgress();
                
                // å…³é—­æ‰€æœ‰PDFè½¬æ¢ç›¸å…³é€šçŸ¥
                const allNotifications = document.querySelectorAll('.notification');
                allNotifications.forEach(notification => {
                    if (notification.textContent.includes('PDF') || notification.textContent.includes('è½¬æ¢')) {
                        const closeBtn = notification.querySelector('.notification-close');
                        if (closeBtn) {
                            closeNotification(closeBtn);
                        }
                    }
                });
                
                return images;
                
            } catch (error) {
                console.error('PDF è½¬æ¢å¤±è´¥:', error);
                
                // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                let errorMessage = 'PDF è½¬æ¢å¤±è´¥';
                if (error.name === 'PasswordException') {
                    errorMessage = 'PDF æ–‡ä»¶å·²åŠ å¯†ï¼Œéœ€è¦å¯†ç æ‰èƒ½æ‰“å¼€';
                } else if (error.name === 'InvalidPDFException') {
                    errorMessage = 'æ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆçš„ PDF æ ¼å¼';
                } else if (error.name === 'MissingPDFException') {
                    errorMessage = 'æ‰¾ä¸åˆ° PDF æ–‡ä»¶';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                // ç¡®ä¿éšè—è¿›åº¦æ¡
                hideProgress();
                
                // å…³é—­æ‰€æœ‰PDFè½¬æ¢ç›¸å…³é€šçŸ¥
                const allNotifications = document.querySelectorAll('.notification');
                allNotifications.forEach(notification => {
                    if (notification.textContent.includes('PDF') || notification.textContent.includes('è½¬æ¢')) {
                        const closeBtn = notification.querySelector('.notification-close');
                        if (closeBtn) {
                            closeNotification(closeBtn);
                        }
                    }
                });
                
                throw new Error(errorMessage);
            }
        }
        window.addEventListener('beforeunload', terminateWorker);
        
        // æ›´æ–°å›¾ç‰‡çŠ¶æ€
        function updateImageStatus(index, status, text) {
            const statusElement = document.getElementById(`status-${index}`);
            if (statusElement) {
                statusElement.className = `image-status status-${status}`;
                statusElement.textContent = text;
            }
        }
        
        // æ›´æ–°å›¾ç‰‡é¡¹å†…å®¹ï¼ˆä¸å†åœ¨æ¯ä¸ªå›¾ç‰‡ä¸‹æ˜¾ç¤ºç»“æœï¼‰
        function updateImageItem(index, text) {
            // åªæ›´æ–°çŠ¶æ€ï¼Œä¸æ˜¾ç¤ºå…·ä½“ç»“æœ
            console.log(`å›¾ç‰‡ ${index + 1} çš„è¯†åˆ«ç»“æœå·²å®Œæˆï¼Œç»“æœå°†åœ¨åˆå¹¶é¢æ¿ä¸­æ˜¾ç¤º`);
        }
        
        // æ›´æ–°æ‰¹é‡è¿›åº¦
        function updateBatchProgress() {
            const completed = batchQueue.filter(item => item.status === 'completed' || item.status === 'error').length;
            const total = batchQueue.length;
            
            const progressElement = document.getElementById('batchProgress');
            if (progressElement) {
                progressElement.textContent = `${completed}/${total} å®Œæˆ`;
            }
        }
        
        // æ›´æ–°æ ‡ç­¾é¡µè®¡æ•°
        function updateTabCounts() {
            const completed = batchResults.length;
            const total = batchQueue.length;
            
            document.getElementById('batchCount').textContent = `${completed}/${total}`;
            document.getElementById('combinedCount').textContent = completed > 0 ? '1' : '0';
        }
        
        // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // å®Œæˆæ‰¹é‡å¤„ç†
        function completeBatchProcessing() {
            isProcessingBatch = false;
            
            const completedCount = batchResults.length;
            const totalCount = batchQueue.length;
            const errorCount = batchQueue.filter(item => item.status === 'error').length;
            
            // éšè—æ‰¹é‡ä¿¡æ¯é¢æ¿
            document.getElementById('batchInfo').classList.remove('show');
            
            // ç”Ÿæˆåˆå¹¶ç»“æœ
            generateCombinedResult();
            
            // æ˜¾ç¤ºå®Œæˆé€šçŸ¥
            let message = `æˆåŠŸå¤„ç† ${completedCount} ä¸ªæ–‡ä»¶`;
            if (errorCount > 0) {
                message += `ï¼Œ${errorCount} ä¸ªæ–‡ä»¶å¤±è´¥`;
            }
            
            showNotification('æ‰¹é‡å¤„ç†å®Œæˆ', message, completedCount > 0 ? 'success' : 'warning');
            
            // æ›´æ–°æ ‡ç­¾é¡µè®¡æ•°
            updateTabCounts();
            
            // ç¡®ä¿éšè—è¿›åº¦æ¡
            hideProgress();
            
            // å…³é—­æ‰€æœ‰æ‰¹é‡å¤„ç†ç›¸å…³é€šçŸ¥
            const allNotifications = document.querySelectorAll('.notification');
            allNotifications.forEach(notification => {
                if (notification.textContent.includes('è¯†åˆ«è¿›è¡Œä¸­') || 
                    notification.textContent.includes('æ­£åœ¨è¯†åˆ«') ||
                    notification.textContent.includes('æ‰¹é‡è¯†åˆ«')) {
                    const closeBtn = notification.querySelector('.notification-close');
                    if (closeBtn) {
                        closeNotification(closeBtn);
                    }
                }
            });
        }
        
        // ç”Ÿæˆåˆå¹¶ç»“æœ
        function generateCombinedResult() {
            if (batchResults.length === 0) return;
            
            let combinedText = '';
            batchResults.forEach((result, index) => {
                if (index > 0) {
                    combinedText += '\n\n';
                }
                combinedText += `=== ${result.filename} ===\n`;
                combinedText += result.text || 'ï¼ˆæœªè¯†åˆ«åˆ°æ–‡å­—ï¼‰';
            });
            
            const combinedElement = document.getElementById('combinedResult');
            if (combinedElement) {
                combinedElement.textContent = combinedText;
            }
            
            // æ›´æ–°å¤„ç†æ—¶é—´æ˜¾ç¤º
            const timeDisplay = document.getElementById('processingTimeDisplay');
            if (timeDisplay && processingTotalTime > 0) {
                const seconds = (processingTotalTime / 1000).toFixed(2);
                timeDisplay.textContent = `${seconds} ç§’`;
                
                // æ›´æ–°å¤„ç†æ—¶é—´çŠ¶æ€ç±»
                if (processingTotalTime < 5000) {
                    timeDisplay.className = 'time-display fast';
                } else if (processingTotalTime < 15000) {
                    timeDisplay.className = 'time-display medium';
                } else {
                    timeDisplay.className = 'time-display slow';
                }
            }
        }
        
        // æš‚åœæ‰¹é‡å¤„ç†
        function pauseBatchProcessing() {
            batchPaused = !batchPaused;
            
            const btn = event.target;
            if (batchPaused) {
                btn.textContent = 'ç»§ç»­';
                showNotification('å¤„ç†å·²æš‚åœ', 'å¯ä»¥ç‚¹å‡»ç»§ç»­æŒ‰é’®æ¢å¤å¤„ç†', 'info');
            } else {
                btn.textContent = 'æš‚åœ';
                showNotification('å¤„ç†å·²æ¢å¤', 'æ‰¹é‡å¤„ç†å°†ç»§ç»­è¿›è¡Œ', 'info');
                startBatchProcessing(); // æ¢å¤å¤„ç†
            }
        }
        
        // å–æ¶ˆæ‰¹é‡å¤„ç†
        function cancelBatchProcessing() {
            isProcessingBatch = false;
            batchPaused = false;
            
            // éšè—æ‰¹é‡ä¿¡æ¯é¢æ¿
            document.getElementById('batchInfo').classList.remove('show');
            
            showNotification('æ‰¹é‡å¤„ç†å·²å–æ¶ˆ', 'å·²åœæ­¢æ‰€æœ‰å¤„ç†ä»»åŠ¡', 'info');
        }
        
        // è®¾ç½®ç»“æœæ ‡ç­¾é¡µäº‹ä»¶
        function setupResultTabs() {
            console.log('=== è®¾ç½®ç»“æœæ ‡ç­¾é¡µäº‹ä»¶ ===');
            
            // ä¸ºæ‰€æœ‰æ ‡ç­¾é¡µæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.result-tab').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabName = this.getAttribute('data-tab');
                    console.log('æ ‡ç­¾é¡µç‚¹å‡»:', tabName);
                    showResultPanel(tabName);
                });
            });
        }
        
        // æ˜¾ç¤ºç»“æœé¢æ¿
        function showResultPanel(panelName) {
            console.log('æ˜¾ç¤ºç»“æœé¢æ¿:', panelName);
            
            // éšè—æ‰€æœ‰é¢æ¿
            document.querySelectorAll('.result-panel').forEach(panel => {
                panel.classList.remove('active');
                panel.style.display = 'none';
            });
            
            // æ˜¾ç¤ºæŒ‡å®šé¢æ¿
            const targetPanel = document.getElementById(panelName + 'Panel');
            if (targetPanel) {
                targetPanel.classList.add('active');
                targetPanel.style.display = 'block';
                console.log('å·²æ˜¾ç¤ºé¢æ¿:', panelName + 'Panel');
            } else {
                console.error('æ‰¾ä¸åˆ°é¢æ¿:', panelName + 'Panel');
            }
            
            // æ›´æ–°æ ‡ç­¾é¡µæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.result-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const targetTab = document.querySelector(`[data-tab="${panelName}"]`);
            if (targetTab) {
                targetTab.classList.add('active');
                console.log('å·²æ¿€æ´»æ ‡ç­¾é¡µ:', panelName);
            } else {
                console.error('æ‰¾ä¸åˆ°æ ‡ç­¾é¡µ:', panelName);
            }
        }
    </script>
</body>
</html>